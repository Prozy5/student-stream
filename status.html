<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>StudentStream Status</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:system-ui, sans-serif;
  background:#0b1028;
  color:white;
  padding:20px;
}

.container{
  max-width:700px;
  margin:auto;
}

h1{
  text-align:center;
  margin-bottom:10px;
}

.overall{
  padding:15px;
  border-radius:10px;
  text-align:center;
  margin-bottom:25px;
  font-weight:600;
}

.operational{background:#0f3;}
.degraded{background:#ffb300;}
.down{background:#ff4d4d;}

.service{
  display:flex;
  justify-content:space-between;
  align-items:center;
  background:#121844;
  padding:14px;
  border-radius:10px;
  margin-bottom:10px;
}

.badge{
  padding:5px 10px;
  border-radius:20px;
  font-size:12px;
  text-transform:uppercase;
}

.badge.operational{background:#00c853;}
.badge.degraded{background:#ffab00;}
.badge.down{background:#d50000;}

.footer{
  text-align:center;
  margin-top:30px;
  font-size:12px;
  color:#aaa;
}
</style>
</head>
<body>

<div class="container">
  <h1>StudentStream Status</h1>
  <div id="overall" class="overall">Loading...</div>

  <div id="services"></div>

  <div class="footer">
    Cloud infrastructure powered by StudentStream â€¢ Updated live
  </div>
</div>

<script>
const supabase = supabase.createClient(
  "YOUR_PROJECT_URL",
  "YOUR_ANON_KEY"
);

async function loadStatus(){
  const {data,error} = await supabase
    .from("system_status")
    .select("*")
    .order("service_name");

  if(error){
    document.getElementById("overall").innerText="Status unavailable";
    return;
  }

  render(data);
}

function render(services){
  const box = document.getElementById("services");
  box.innerHTML = "";

  let overall = "operational";

  services.forEach(s=>{
    if(s.status==="down") overall="down";
    if(s.status==="degraded" && overall!=="down") overall="degraded";

    const div = document.createElement("div");
    div.className="service";

    div.innerHTML = `
      <div>${s.service_name}</div>
      <div class="badge ${s.status}">${s.status}</div>
    `;

    box.appendChild(div);
  });

  const overallBox=document.getElementById("overall");
  overallBox.className="overall "+overall;

  overallBox.innerText=
    overall==="operational" ? "All systems operational" :
    overall==="degraded" ? "Some systems degraded" :
    "Major outage";
}

// Realtime updates
supabase.channel("status")
  .on("postgres_changes",{event:"*",schema:"public",table:"system_status"},loadStatus)
  .subscribe();

loadStatus();
</script>

</body>
</html>