<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudentStream Status V4</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont;
  background:#070b12;
  color:white;
}

header{
  padding:22px 26px;
  border-bottom:1px solid #1c2533;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-size:22px;
  font-weight:900;
  color:#4da3ff;
}

.subtitle{
  font-size:14px;
  opacity:.6;
}

.container{
  max-width:1100px;
  margin:40px auto;
  padding:0 20px;
}

.card{
  background:#0e1522;
  border:1px solid #1f2a3a;
  border-radius:18px;
  padding:22px;
  margin-bottom:22px;
}

.overall{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.badge{
  padding:10px 18px;
  border-radius:999px;
  font-weight:700;
  font-size:14px;
}

.good{background:#123d26;color:#3cff7a;}
.warn{background:#3d2d12;color:#ffb84d;}
.bad{background:#3d1212;color:#ff4d4d;}

.section-title{
  font-size:22px;
  font-weight:800;
  margin-bottom:8px;
}

.section-sub{
  opacity:.6;
  font-size:14px;
  margin-bottom:14px;
}

.grid{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
  gap:18px;
}

.service{
  display:flex;
  justify-content:space-between;
  padding:12px 0;
  border-bottom:1px solid rgba(255,255,255,0.06);
}

.service:last-child{border-bottom:none;}

.dot{
  width:10px;
  height:10px;
  border-radius:50%;
  display:inline-block;
  margin-right:8px;
}

.up{background:#3cff7a;}
.down{background:#ff4d4d;}
.degraded{background:#ffb84d;}

small{
  opacity:.5;
}

.timeline{
  margin-top:12px;
  padding-left:14px;
  border-left:2px solid rgba(255,255,255,0.12);
}

.timeline p{
  margin:10px 0;
  font-size:14px;
  opacity:.8;
}

button{
  border:none;
  cursor:pointer;
  padding:12px 18px;
  border-radius:12px;
  font-weight:700;
}

.subscribe-btn{
  background:linear-gradient(90deg,#4da3ff,#00ffcc);
  color:black;
  margin-top:14px;
}

footer{
  margin-top:60px;
  padding:30px;
  text-align:center;
  opacity:.5;
  font-size:13px;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  display:none;
  justify-content:center;
  align-items:center;
}

.modal-box{
  width:90%;
  max-width:400px;
  background:#0e1522;
  padding:25px;
  border-radius:18px;
  border:1px solid #1f2a3a;
}

.modal-box input{
  width:100%;
  padding:14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.15);
  background:#070b12;
  color:white;
  margin-top:12px;
}

.close{
  float:right;
  font-size:20px;
  cursor:pointer;
  opacity:.6;
}
</style>
</head>
<body>

<header>
  <div>
    <div class="logo">StudentStream Status</div>
    <div class="subtitle">System Health ‚Ä¢ Live Updates</div>
  </div>
  <div id="lastUpdated" class="subtitle">Updating...</div>
</header>

<div class="container">

  <!-- Overall Status -->
  <div class="card overall">
    <div>
      <div class="section-title" id="overallText">Loading...</div>
      <div class="section-sub">Real-time platform availability</div>
    </div>
    <div id="overallBadge" class="badge good">Operational</div>
  </div>

  <!-- Uptime -->
  <div class="card">
    <div class="section-title">Uptime (Last 30 Days)</div>
    <div class="section-sub">StudentStreamHQ reliability performance</div>
    <h2 id="uptimePercent">99.99%</h2>
    <small>Graph support coming next upgrade</small>
  </div>

  <!-- Active Incidents -->
  <div class="card">
    <div class="section-title">Active Incidents</div>
    <div class="section-sub" id="incidentBox">Loading incidents...</div>
  </div>

  <!-- Maintenance -->
  <div class="card">
    <div class="section-title">Scheduled Maintenance</div>
    <div class="section-sub" id="maintenanceBox">
      Loading maintenance schedule...
    </div>
  </div>

  <!-- Services -->
  <div class="card">
    <div class="section-title">Service Status</div>
    <div class="section-sub">Divisions across StudentStreamHQ infrastructure</div>

    <div class="grid" id="serviceGrid"></div>

    <button class="subscribe-btn" onclick="openModal()">
      üîî Subscribe to Updates
    </button>
  </div>

  <!-- Past Incidents -->
  <div class="card">
    <div class="section-title">Incident History</div>
    <div class="section-sub" id="historyBox">
      Loading history...
    </div>
  </div>

</div>

<footer>
  ¬© 2026 StudentStreamHQ ‚Ä¢ Status Page V4.0 ‚Ä¢ Infrastructure
</footer>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="modal-box">
    <span class="close" onclick="closeModal()">‚úï</span>
    <h2>Subscribe</h2>
    <p style="opacity:.7;margin-top:8px;">
      Get notified when StudentStream services change status.
    </p>
    <input placeholder="Email address..." />
    <button class="subscribe-btn" style="width:100%;margin-top:14px;">
      Subscribe (Coming Soon)
    </button>
  </div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

const serviceGrid = document.getElementById("serviceGrid");
const overallText = document.getElementById("overallText");
const overallBadge = document.getElementById("overallBadge");

const incidentBox = document.getElementById("incidentBox");
const historyBox = document.getElementById("historyBox");
const maintenanceBox = document.getElementById("maintenanceBox");
const lastUpdated = document.getElementById("lastUpdated");

function updateTimestamp(){
  lastUpdated.textContent =
    "Updated " + new Date().toLocaleTimeString();
}

async function loadServices(){
  const { data } = await supabase
    .from("system_status")
    .select("*")
    .order("division");

  renderServices(data);
}

function renderServices(rows){
  let hasDown=false, hasDegraded=false;
  const divisions={};

  rows.forEach(r=>{
    if(!divisions[r.division]) divisions[r.division]=[];
    divisions[r.division].push(r);

    if(r.status==="down") hasDown=true;
    if(r.status==="degraded") hasDegraded=true;
  });

  serviceGrid.innerHTML="";

  Object.entries(divisions).forEach(([division,services])=>{
    const card=document.createElement("div");
    card.className="card";

    let html=`<h2>${division}</h2>`;

    services.forEach(s=>{
      let dot="up";
      if(s.status==="down") dot="down";
      if(s.status==="degraded") dot="degraded";

      html+=`
        <div class="service">
          <span><span class="dot ${dot}"></span>${s.service}</span>
          <span style="opacity:.6">${s.status}</span>
        </div>
      `;
    });

    card.innerHTML=html;
    serviceGrid.appendChild(card);
  });

  if(hasDown){
    overallText.textContent="Major Outage";
    overallBadge.className="badge bad";
    overallBadge.textContent="Down";
  } else if(hasDegraded){
    overallText.textContent="Partial Degradation";
    overallBadge.className="badge warn";
    overallBadge.textContent="Degraded";
  } else {
    overallText.textContent="All Systems Operational";
    overallBadge.className="badge good";
    overallBadge.textContent="Operational";
  }
}

async function loadIncidents(){
  const { data } = await supabase
    .from("status_incidents")
    .select("*")
    .order("created_at",{ascending:false});

  if(!data || data.length===0){
    incidentBox.innerHTML="No active incidents üéâ";
    historyBox.innerHTML="No incident history yet.";
    return;
  }

  const active=data.filter(i=>i.incident_status!=="resolved");
  const past=data.filter(i=>i.incident_status==="resolved");

  incidentBox.innerHTML = active.length
    ? active.map(i=>`‚ö†Ô∏è ${i.title} (${i.severity})`).join("<br>")
    : "No active incidents üéâ";

  historyBox.innerHTML = past.length
    ? past.map(i=>`‚úÖ ${i.title}`).join("<br>")
    : "No past incidents yet.";
}

async function loadMaintenance(){
  const { data } = await supabase
    .from("status_maintenance")
    .select("*")
    .order("scheduled_for",{ascending:true});

  if(!data || data.length===0){
    maintenanceBox.innerHTML="No maintenance scheduled.";
    return;
  }

  maintenanceBox.innerHTML=data.map(m=>
    `üõ†Ô∏è ${m.title} ‚Äî ${new Date(m.scheduled_for).toLocaleDateString()}`
  ).join("<br>");
}

async function refresh(){
  updateTimestamp();
  await loadServices();
  await loadIncidents();
  await loadMaintenance();
}

refresh();
setInterval(refresh,30000);

window.openModal=()=>document.getElementById("modal").style.display="flex";
window.closeModal=()=>document.getElementById("modal").style.display="none";
</script>

</body>
</html>