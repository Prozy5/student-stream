<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudentStream System Status</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  background: #070b12;
  color: white;
}

/* HEADER */
header {
  padding: 22px 26px;
  border-bottom: 1px solid #1c2533;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.logo {
  font-size: 22px;
  font-weight: 900;
  color: #4da3ff;
}

.subtext {
  opacity: .6;
  font-size: 14px;
}

/* PAGE CONTAINER */
.container {
  max-width: 1100px;
  margin: 40px auto;
  padding: 0 22px;
}

/* OVERALL STATUS CARD */
.overall {
  background: #0e1522;
  border: 1px solid #1f2a3a;
  border-radius: 18px;
  padding: 26px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.overall b {
  font-size: 22px;
}

.badge {
  padding: 8px 18px;
  border-radius: 999px;
  font-weight: 700;
  font-size: 14px;
}

/* STATUS COLORS */
.badge.good {
  background: rgba(60, 255, 122, 0.15);
  color: #3cff7a;
}

.badge.warn {
  background: rgba(255, 184, 77, 0.15);
  color: #ffb84d;
}

.badge.bad {
  background: rgba(255, 77, 77, 0.15);
  color: #ff4d4d;
}

.badge.maint {
  background: rgba(77, 163, 255, 0.15);
  color: #4da3ff;
}

/* SECTIONS */
.section {
  margin-top: 50px;
}

.section h2 {
  font-size: 22px;
  margin-bottom: 6px;
}

.section p {
  opacity: .6;
  margin-top: 0;
  font-size: 15px;
}

/* SERVICE GRID */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 18px;
  margin-top: 22px;
}

/* SERVICE CARD */
.card {
  background: #0e1522;
  border: 1px solid #1f2a3a;
  border-radius: 18px;
  padding: 20px;
}

.card b {
  font-size: 17px;
}

/* SERVICE ROW */
.service {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-top: 14px;
  font-size: 14px;
  padding-bottom: 10px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
}

.service:last-child {
  border-bottom: none;
}

/* DOT COLORS */
.dot {
  display: inline-block;
  width: 9px;
  height: 9px;
  border-radius: 50%;
  margin-right: 8px;
}

.up { background: #3cff7a; }
.down { background: #ff4d4d; }
.degraded { background: #ffb84d; }
.maintenance { background: #4da3ff; }

/* TEXT STATUS */
.status-good { color: #3cff7a; }
.status-bad { color: #ff4d4d; }
.status-warn { color: #ffb84d; }
.status-maint { color: #4da3ff; }

/* BUTTON */
.subscribe-btn {
  margin-top: 20px;
  padding: 14px;
  border-radius: 14px;
  border: none;
  width: 100%;
  background: linear-gradient(90deg, #4da3ff, #3cff7a);
  font-weight: 800;
  font-size: 15px;
  cursor: pointer;
}

/* FOOTER */
footer {
  border-top: 1px solid #1c2533;
  margin-top: 70px;
  padding: 35px;
  text-align: center;
  font-size: 13px;
  opacity: .6;
}
</style>
</head>

<body>

<header>
  <div>
    <div class="logo">StudentStream Status</div>
    <div class="subtext">System Health â€¢ Live Updates</div>
  </div>
  <div class="subtext" id="lastUpdated">Updated: --</div>
</header>

<div class="container">

  <!-- OVERALL STATUS -->
  <div class="overall">
    <div>
      <b id="overallText">Loading...</b>
      <div class="subtext">Real-time platform availability</div>
    </div>
    <div class="badge good" id="overallBadge">...</div>
  </div>

  <!-- INCIDENTS -->
  <div class="section">
    <h2>Active Incidents</h2>
    <p id="incidentText">Loading incidents...</p>
  </div>

  <!-- MAINTENANCE -->
  <div class="section">
    <h2>Scheduled Maintenance</h2>
    <p id="maintText">No maintenance scheduled.</p>
  </div>

  <!-- SERVICE STATUS -->
  <div class="section">
    <h2>Service Status</h2>
    <p>Divisions across StudentStreamHQ infrastructure</p>

    <div class="grid"></div>

    <button class="subscribe-btn">
      ðŸ”” Subscribe to Updates
    </button>
  </div>

  <!-- HISTORY -->
  <div class="section">
    <h2>Incident History</h2>
    <p>No incident history yet.</p>
  </div>

</div>

<footer>
  Â© 2026 StudentStreamHQ â€¢ Status Page V4.1 â€¢ Infrastructure
</footer>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

const grid = document.querySelector(".grid");
const overallText = document.getElementById("overallText");
const overallBadge = document.getElementById("overallBadge");
const lastUpdated = document.getElementById("lastUpdated");

async function loadStatus() {
  const { data, error } = await supabase
    .from("system_status")
    .select("*")
    .order("division");

  if (error) {
    overallText.textContent = "Unable to load system status";
    overallBadge.textContent = "Offline";
    overallBadge.className = "badge bad";
    return;
  }

  renderStatus(data);
}

function renderStatus(rows) {
  const divisions = {};
  let hasDown = false;
  let hasDegraded = false;
  let hasMaint = false;

  rows.forEach(r => {
    if (!divisions[r.division]) divisions[r.division] = [];
    divisions[r.division].push(r);

    if (r.status === "down") hasDown = true;
    if (r.status === "degraded") hasDegraded = true;
    if (r.status === "maintenance") hasMaint = true;
  });

  grid.innerHTML = "";

  Object.entries(divisions).forEach(([division, services]) => {
    const card = document.createElement("div");
    card.className = "card";

    let html = `<b>${division}</b>`;

    services.forEach(s => {
      let dotClass = "up";
      let statusClass = "status-good";

      if (s.status === "down") {
        dotClass = "down";
        statusClass = "status-bad";
      }

      if (s.status === "degraded") {
        dotClass = "degraded";
        statusClass = "status-warn";
      }

      if (s.status === "maintenance") {
        dotClass = "maintenance";
        statusClass = "status-maint";
      }

      html += `
        <div class="service">
          <span><span class="dot ${dotClass}"></span>${s.service}</span>
          <span class="${statusClass}">${s.status}</span>
        </div>
      `;
    });

    card.innerHTML = html;
    grid.appendChild(card);
  });

  // OVERALL STATUS LOGIC
  if (hasDown) {
    overallText.textContent = "Major System Outage";
    overallBadge.textContent = "Down";
    overallBadge.className = "badge bad";
  } else if (hasDegraded) {
    overallText.textContent = "Partial Degradation";
    overallBadge.textContent = "Degraded";
    overallBadge.className = "badge warn";
  } else if (hasMaint) {
    overallText.textContent = "Maintenance In Progress";
    overallBadge.textContent = "Maintenance";
    overallBadge.className = "badge maint";
  } else {
    overallText.textContent = "All Systems Operational";
    overallBadge.textContent = "Operational";
    overallBadge.className = "badge good";
  }

  lastUpdated.textContent =
    "Updated: " + new Date().toLocaleTimeString();
}

loadStatus();
setInterval(loadStatus, 30000);
</script>

</body>
</html>