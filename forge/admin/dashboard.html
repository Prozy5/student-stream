<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forge Admin</title>

<script src="https://cdn.tailwindcss.com"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{background:#0f172a;font-family:Inter,sans-serif;}
.glass{background:rgba(255,255,255,0.05);backdrop-filter:blur(20px);border:1px solid rgba(255,255,255,0.08);}
</style>
</head>

<body class="text-gray-200">

<!-- LOGIN SCREEN -->
<div id="loginScreen" class="min-h-screen flex items-center justify-center">
<div class="glass p-10 rounded-2xl w-96">
<h1 class="text-2xl text-cyan-400 mb-6 font-semibold">Forge Admin Login</h1>

<input id="email" placeholder="Email"
class="w-full p-3 mb-4 bg-black/40 rounded-xl outline-none">

<input id="password" type="password" placeholder="Password"
class="w-full p-3 mb-6 bg-black/40 rounded-xl outline-none">

<button onclick="login()" 
class="w-full bg-cyan-500 hover:bg-cyan-600 p-3 rounded-xl">
Login
</button>

<p id="authMessage" class="text-sm text-red-400 mt-4"></p>
</div>
</div>

<!-- ADMIN PANEL -->
<div id="panel" class="hidden min-h-screen flex">

<!-- SIDEBAR -->
<aside class="w-64 p-6 glass">
<h1 class="text-2xl text-cyan-400 mb-8">FORGE</h1>
<button onclick="logout()" class="text-sm text-red-400">Logout</button>
</aside>

<!-- MAIN -->
<main class="flex-1 p-10">

<h2 class="text-3xl mb-6 font-semibold">Dashboard</h2>

<!-- CLIENTS -->
<div class="glass p-6 rounded-2xl mb-8">
<h3 class="text-lg mb-4">Clients</h3>

<div class="flex gap-3 mb-4">
<input id="clientName" placeholder="Client Name"
class="p-2 bg-black/40 rounded-lg">
<input id="clientEmail" placeholder="Email"
class="p-2 bg-black/40 rounded-lg">
<button onclick="addClient()" 
class="bg-green-500 px-4 rounded-lg">Add</button>
</div>

<ul id="clientList" class="space-y-2 text-sm"></ul>
</div>

<!-- ALERTS -->
<div class="glass p-6 rounded-2xl">
<h3 class="text-lg mb-4">Realtime Alerts</h3>
<ul id="alertList" class="space-y-2 text-sm"></ul>
</div>

<!-- INSTAGRAM OAUTH PLACEHOLDER -->
<div class="glass p-6 rounded-2xl mt-8">
<h3 class="text-lg mb-4">Instagram Integration</h3>
<button class="bg-purple-500 px-5 py-2 rounded-xl">
Connect Instagram (OAuth)
</button>
<p class="text-xs text-gray-400 mt-3">
OAuth setup required via Meta Developer Dashboard.
</p>
</div>

</main>
</div>

<script>

/* ===== SUPABASE CONFIG ===== */
const supabase = window.supabase.createClient(
"https://iabzmoxzbqzcqgypxctr.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

/* ===== AUTH ===== */
async function login(){
const {data,error} = await supabase.auth.signInWithPassword({
email:document.getElementById("email").value,
password:document.getElementById("password").value
});
if(error){
document.getElementById("authMessage").innerText=error.message;
}else{
initApp();
}
}

async function logout(){
await supabase.auth.signOut();
location.reload();
}

async function checkSession(){
const {data:{session}}=await supabase.auth.getSession();
if(session){
initApp();
}
}
checkSession();

/* ===== INIT APP ===== */
async function initApp(){
document.getElementById("loginScreen").classList.add("hidden");
document.getElementById("panel").classList.remove("hidden");
loadClients();
loadAlerts();
subscribeRealtime();
}

/* ===== CLIENTS ===== */
async function loadClients(){
let {data}=await supabase.from("clients").select("*").order("created_at",{ascending:false});
renderClients(data);
}

function renderClients(clients){
let list=document.getElementById("clientList");
list.innerHTML="";
clients.forEach(c=>{
list.innerHTML+=`<li class="bg-black/30 p-3 rounded-lg">
${c.name} â€” ${c.status}
</li>`;
});
}

async function addClient(){
let name=document.getElementById("clientName").value;
let email=document.getElementById("clientEmail").value;

await supabase.from("clients").insert([{name,email}]);
loadClients();
}

/* ===== ALERTS ===== */
async function loadAlerts(){
let {data}=await supabase.from("alerts").select("*").order("created_at",{ascending:false});
renderAlerts(data);
}

function renderAlerts(alerts){
let list=document.getElementById("alertList");
list.innerHTML="";
alerts.forEach(a=>{
list.innerHTML+=`<li class="bg-black/30 p-3 rounded-lg">
${a.message}
</li>`;
});
}

/* ===== REALTIME ===== */
function subscribeRealtime(){
supabase.channel("realtime-alerts")
.on("postgres_changes",
{event:"INSERT",schema:"public",table:"alerts"},
payload=>{
loadAlerts();
})
.subscribe();
}

</script>

</body>
</html>