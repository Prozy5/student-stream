<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Forge Orbital Command</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
* { margin:0; padding:0; box-sizing:border-box; }

body {
  background:#020617;
  overflow:hidden;
  font-family: 'Segoe UI', sans-serif;
  color:white;
}

/* ================= SPACE BACKGROUND ================= */

#space {
  position:fixed;
  width:100%;
  height:100%;
  background:radial-gradient(circle at center,#0b1f3a 0%,#020617 70%);
  overflow:hidden;
}

/* Star field */
.star {
  position:absolute;
  width:2px;
  height:2px;
  background:white;
  opacity:0.6;
  border-radius:50%;
}

/* ================= EARTH ================= */

.earth-wrapper {
  position:absolute;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:420px;
  height:420px;
}

.earth {
  width:100%;
  height:100%;
  border-radius:50%;
  background:
    radial-gradient(circle at 35% 35%, #5dade2, #1b4f72 60%);
  box-shadow:
    0 0 120px rgba(0,174,255,0.6),
    inset -40px -40px 80px rgba(0,0,0,0.6);
  animation: spin 40s linear infinite;
}

.atmosphere {
  position:absolute;
  width:110%;
  height:110%;
  border-radius:50%;
  top:-5%;
  left:-5%;
  box-shadow:0 0 120px rgba(0,174,255,0.4);
}

@keyframes spin {
  from { transform:rotate(0deg); }
  to { transform:rotate(360deg); }
}

/* ================= ORBITS ================= */

.orbit {
  position:absolute;
  border:1px dashed rgba(255,255,255,0.08);
  border-radius:50%;
  animation: orbit linear infinite;
}

.orbit.one { width:550px; height:550px; top:50%; left:50%; transform:translate(-50%,-50%); animation-duration:18s; }
.orbit.two { width:700px; height:700px; top:50%; left:50%; transform:translate(-50%,-50%); animation-duration:28s; }

@keyframes orbit {
  from { transform:translate(-50%,-50%) rotate(0deg); }
  to { transform:translate(-50%,-50%) rotate(360deg); }
}

.satellite {
  width:18px;
  height:18px;
  background:#00f5d4;
  border-radius:4px;
  position:absolute;
  top:-9px;
  left:50%;
  transform:translateX(-50%);
  box-shadow:0 0 20px #00f5d4;
}

/* ================= DASHBOARD ================= */

.dashboard {
  position:absolute;
  top:20px;
  left:20px;
  width:340px;
  padding:20px;
  border-radius:16px;
  background:rgba(10,15,25,0.7);
  backdrop-filter:blur(12px);
  box-shadow:0 0 40px rgba(0,255,255,0.15);
}

.dashboard h2 {
  margin-bottom:12px;
  font-size:18px;
}

.metric {
  font-size:13px;
  margin-bottom:8px;
}

.value {
  font-size:18px;
  font-weight:bold;
  color:#00f5d4;
}

.alert {
  color:#ff4d4d !important;
}

/* Subscription Table */
table {
  width:100%;
  font-size:11px;
  margin-top:8px;
}

td {
  padding:3px;
}

/* Responsive */
@media(max-width:768px){
  .earth-wrapper { width:300px; height:300px; }
  .orbit.one { width:420px; height:420px; }
  .orbit.two { width:520px; height:520px; }
  .dashboard { width:90%; left:5%; }
}

</style>
</head>

<body>
<div id="space"></div>

<div class="earth-wrapper">
  <div class="atmosphere"></div>
  <div class="earth"></div>
</div>

<div class="orbit one">
  <div class="satellite"></div>
</div>

<div class="orbit two">
  <div class="satellite"></div>
</div>

<div class="dashboard">
  <h2>Forge Orbital Command</h2>

  <div class="metric">Active MRR: <span id="mrr" class="value">$0</span></div>
  <div class="metric">Rolling 30 MRR: <span id="rolling" class="value">$0</span></div>
  <div class="metric">Churn %: <span id="churn" class="value">0%</span></div>
  <div class="metric">Revenue At Risk: <span id="risk" class="value">$0</span></div>
  <div class="metric">90-Day Forecast: <span id="forecast" class="value">$0</span></div>
  <div class="metric">Volatility: <span id="volatility" class="value">0</span></div>
  <div class="metric">Fusion Score: <span id="fusion" class="value">0</span></div>
  <div class="metric">Global Threat Index: <span id="gti" class="value">0</span></div>

  <h3 style="margin-top:10px;font-size:13px;">Subscription Health</h3>
  <table><tbody id="health"></tbody></table>
</div>

<script>
const SUPABASE_URL = "https://iabzmoxzbqzcqgypxctr.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQY";
const client = supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

/* Generate stars */
for(let i=0;i<120;i++){
  const star=document.createElement("div");
  star.className="star";
  star.style.top=Math.random()*100+"%";
  star.style.left=Math.random()*100+"%";
  document.getElementById("space").appendChild(star);
}

async function loadData(){
  const {data:exec} = await client.from("forge_executive_dashboard").select("*").single();
  if(exec){
    mrr.innerText="$"+exec.active_mrr;
    rolling.innerText="$"+exec.rolling_30_mrr;
    churn.innerText=exec.churn_percentage+"%";
    risk.innerText="$"+exec.revenue_at_risk;
    forecast.innerText="$"+exec.projected_90_day_revenue;
    volatility.innerText=exec.volatility_index;
    fusion.innerText=Math.round(exec.fusion_score);
  }

  const {data:gtiData} = await client.from("forge_system_state")
    .select("global_threat_index").eq("id",1).single();

  if(gtiData){
    gti.innerText=gtiData.global_threat_index;

    if(gtiData.global_threat_index > 70){
      document.querySelector(".earth").style.background =
        "radial-gradient(circle at 35% 35%, #ff4d4d, #7a0000 60%)";
    }
  }

  const {data:healthData} = await client.from("forge_subscription_health").select("*");
  health.innerHTML="";
  healthData?.forEach(row=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${row.client_id.substring(0,6)}</td>
      <td>$${row.amount}</td>
      <td>${row.churn_risk_score}</td>
      <td>${row.subscription_health_score}</td>
    `;
    health.appendChild(tr);
  });
}

client.channel("realtime")
.on("postgres_changes",{event:"*",schema:"public"},()=>loadData())
.subscribe();

loadData();
</script>

</body>
</html>