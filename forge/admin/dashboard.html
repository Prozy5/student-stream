<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Forge Orbital Command</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body {
  margin:0;
  background:#000814;
  color:white;
  font-family:Arial;
  overflow:hidden;
}

#space {
  position:absolute;
  width:100%;
  height:100%;
  background:radial-gradient(circle at center,#001d3d 0%,#000814 70%);
}

.earth {
  position:absolute;
  width:300px;
  height:300px;
  border-radius:50%;
  background:radial-gradient(circle at 30% 30%,#4cc9f0,#023e8a 70%);
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  box-shadow:0 0 60px #00b4d8;
  animation:spin 20s linear infinite;
}

@keyframes spin {
  from { transform:translate(-50%,-50%) rotate(0deg); }
  to { transform:translate(-50%,-50%) rotate(360deg); }
}

.orbit {
  position:absolute;
  width:500px;
  height:500px;
  border:1px dashed rgba(255,255,255,0.1);
  border-radius:50%;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  animation:orbitSpin 15s linear infinite;
}

@keyframes orbitSpin {
  from { transform:translate(-50%,-50%) rotate(0deg); }
  to { transform:translate(-50%,-50%) rotate(360deg); }
}

.satellite {
  width:20px;
  height:20px;
  background:#90e0ef;
  border-radius:4px;
  position:absolute;
  top:-10px;
  left:50%;
  transform:translateX(-50%);
  box-shadow:0 0 15px #00f5d4;
}

.dashboard {
  position:absolute;
  top:20px;
  left:20px;
  width:380px;
  background:rgba(0,0,0,0.6);
  padding:20px;
  border-radius:10px;
  backdrop-filter:blur(8px);
}

.metric {
  margin-bottom:12px;
  font-size:16px;
}

.value {
  font-size:22px;
  font-weight:bold;
  color:#00f5d4;
}

table {
  width:100%;
  margin-top:10px;
  font-size:12px;
}

td {
  padding:4px;
}
</style>
</head>

<body>
<div id="space"></div>

<div class="earth"></div>

<div class="orbit">
  <div class="satellite"></div>
</div>

<div class="dashboard">
  <h2>Forge Orbital Command</h2>

  <div class="metric">Active MRR: <span id="mrr" class="value">$0</span></div>
  <div class="metric">Rolling 30 MRR: <span id="rolling" class="value">$0</span></div>
  <div class="metric">Churn %: <span id="churn" class="value">0%</span></div>
  <div class="metric">Revenue At Risk: <span id="risk" class="value">$0</span></div>
  <div class="metric">90-Day Forecast: <span id="forecast" class="value">$0</span></div>
  <div class="metric">Volatility Index: <span id="volatility" class="value">0</span></div>
  <div class="metric">Fusion Score: <span id="fusion" class="value">0</span></div>
  <div class="metric">Global Threat Index: <span id="gti" class="value">0</span></div>

  <h3>Subscription Health</h3>
  <table>
    <tbody id="health"></tbody>
  </table>
</div>

<script>
const SUPABASE_URL = "https://iabzmoxzbqzcqgypxctr.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ";

const client = supabase.createClient(SUPABASE_URL,SUPABASE_KEY);

async function loadData(){

  const {data: exec} = await client
    .from("forge_executive_dashboard")
    .select("*")
    .single();

  if(exec){
    document.getElementById("mrr").innerText="$"+exec.active_mrr;
    document.getElementById("rolling").innerText="$"+exec.rolling_30_mrr;
    document.getElementById("churn").innerText=exec.churn_percentage+"%";
    document.getElementById("risk").innerText="$"+exec.revenue_at_risk;
    document.getElementById("forecast").innerText="$"+exec.projected_90_day_revenue;
    document.getElementById("volatility").innerText=exec.volatility_index;
    document.getElementById("fusion").innerText=Math.round(exec.fusion_score);
  }

  const {data:gti} = await client
    .from("forge_system_state")
    .select("global_threat_index")
    .eq("id",1)
    .single();

  if(gti){
    document.getElementById("gti").innerText=gti.global_threat_index;
  }

  const {data:health} = await client
    .from("forge_subscription_health")
    .select("*");

  const table=document.getElementById("health");
  table.innerHTML="";

  if(health){
    health.forEach(row=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`
        <td>${row.client_id.substring(0,6)}</td>
        <td>$${row.amount}</td>
        <td>${row.churn_risk_score}</td>
        <td>${row.subscription_health_score}</td>
      `;
      table.appendChild(tr);
    });
  }
}

client.channel("realtime")
.on("postgres_changes",{event:"*",schema:"public"},()=>{
  loadData();
})
.subscribe();

loadData();
</script>

</body>
</html>