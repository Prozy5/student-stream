<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Forge Portal Login</title>

<style>
body{
  background:#050806;
  color:white;
  font-family:system-ui;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}

.box{
  width:420px;
  padding:35px;
  border-radius:18px;
  border:1px solid rgba(108,255,159,0.20);
  background:rgba(12,18,14,0.92);
}

h1{
  font-size:26px;
  font-weight:1000;
}
h1 span{color:#6cff9f;}

input{
  width:100%;
  padding:12px;
  margin-top:14px;
  border-radius:12px;
  border:1px solid rgba(255,255,255,0.10);
  background:rgba(255,255,255,0.03);
  color:white;
}

button{
  width:100%;
  margin-top:18px;
  padding:13px;
  border:none;
  border-radius:12px;
  font-weight:900;
  cursor:pointer;
  background:rgba(108,255,159,0.20);
  color:#6cff9f;
}
button:hover{
  background:rgba(108,255,159,0.35);
}

#status{
  margin-top:14px;
  opacity:.75;
  font-size:13px;
}
</style>
</head>

<body>

<div class="box">
  <h1>Forge <span>Staff Portal</span></h1>
  <p style="opacity:.7;margin-top:6px;">
    StudentStreamHQ internal access only.
  </p>

  <input id="email" type="email" placeholder="Staff Email">
  <input id="password" type="password" placeholder="Password">

  <button onclick="login()">Login →</button>

  <p id="status"></p>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

window.login = async function(){

  const status = document.getElementById("status");
  status.innerText = "Checking access...";

  const email = document.getElementById("email").value;
  const password = document.getElementById("password").value;

  // 1. Sign in
  const { data, error } = await supabase.auth.signInWithPassword({
    email,password
  });

  if(error){
    status.innerText = "❌ Login failed.";
    return;
  }

  // 2. Staff whitelist check
  const { data: staff } = await supabase
    .from("forge_staff")
    .select("*")
    .eq("id", data.user.id)
    .single();

  if(!staff){
    status.innerText = "❌ Access denied. Not Staff.";
    await supabase.auth.signOut();
    return;
  }

  status.innerText = "✅ Welcome Staff Member.";

  // 3. Redirect to dashboard
  location.href="forge-admin-dashboard.html";
};
</script>

</body>
</html>