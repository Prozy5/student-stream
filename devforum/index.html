<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudentStream DevForum</title>
<link rel="stylesheet" href="forum.css">
</head>
<body>

<div class="topbar">
 <div class="logo">StudentStream DevForum</div>
 <a href="new.html" class="new-btn">+ New Thread</a>
</div>

<div class="forum-container">
 <h2>Threads</h2>
 <div id="threads">Loading threads...</div>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>
<script>
const SUPABASE_URL = "https://iabzmoxzbqzcqgypxctr.supabase.co";
const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ";

const supabase = supabaseJs.createClient(SUPABASE_URL, SUPABASE_KEY);

const threadsDiv = document.getElementById("threads");

async function loadThreads() {
 const { data, error } = await supabase
 .from("forum_posts")
 .select("*")
 .order("created_at", { ascending: false });

 if (error) {
 threadsDiv.textContent = "Failed to load threads: " + error.message;
 return;
 }

 if (!data.length) {
 threadsDiv.innerHTML = "<p>No threads yet.</p>";
 return;
 }

 threadsDiv.innerHTML = "";

 data.forEach(post => {
 const div = document.createElement("div");
 div.className = "thread-card";

 div.innerHTML = `
 <div class="thread-title">${escapeHtml(post.title)}</div>
 <div class="thread-meta">
 by <strong>${escapeHtml(post.username)}</strong> • ${new Date(post.created_at).toLocaleString()}
 • <span class="category">${post.category}</span>
 </div>
 <div class="thread-preview">
 ${escapeHtml(post.content.substring(0, 150))}${post.content.length > 150 ? "..." : ""}
 </div>
 `;

 div.onclick = () => {
 window.location.href = `thread.html?id=${post.id}`;
 };

 threadsDiv.appendChild(div);
 });
}

function escapeHtml(text) {
 return text.replace(/[&<>"']/g, function(m) {
 return ({
 '&':'&amp;',
 '<':'&lt;',
 '>':'&gt;',
 '"':'&quot;',
 "'":'&#039;'
 })[m];
 });
}

loadThreads();
</script>

</body>
</html>
