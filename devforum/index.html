<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>StudentStream DevForum</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
/* =======================
   CORE THEME (V200)
======================= */
:root{
  --bg:#070a11;
  --panel:#0e1526;
  --panel2:#121a2f;
  --border:#1f2937;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#22c55e;
  --blue:#3b82f6;
  --amber:#f59e0b;
  --red:#ef4444;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:linear-gradient(180deg,#070a11,#05070d);
  color:var(--text);
  font-family:Inter,system-ui,sans-serif;
}

/* =======================
   HEADER
======================= */
header{
  position:sticky;
  top:0;
  z-index:50;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:14px 18px;
  background:rgba(7,10,17,.9);
  backdrop-filter:blur(10px);
  border-bottom:1px solid var(--border);
}

.brand{
  display:flex;
  flex-direction:column;
}
.brand h1{
  margin:0;
  font-size:15px;
  font-weight:600;
}
.brand span{
  font-size:11px;
  color:var(--muted);
}

header input{
  width:260px;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:8px;
  padding:8px 10px;
  color:var(--text);
}

/* =======================
   LAYOUT
======================= */
.layout{
  display:grid;
  grid-template-columns:300px 1fr;
  min-height:calc(100vh - 62px);
}

/* =======================
   SIDEBAR
======================= */
aside{
  background:var(--panel);
  border-right:1px solid var(--border);
  padding:14px;
  overflow-y:auto;
}

.group{
  margin-bottom:18px;
}
.group-title{
  font-size:11px;
  color:var(--muted);
  letter-spacing:.08em;
  margin-bottom:6px;
  text-transform:uppercase;
}

.category{
  padding:10px 12px;
  border-radius:8px;
  cursor:pointer;
}
.category:hover{
  background:#1f2937;
}
.category.active{
  background:#1f2937;
  border-left:3px solid var(--accent);
}

.cat-row{
  display:flex;
  justify-content:space-between;
  font-size:14px;
}
.cat-desc{
  font-size:11px;
  color:var(--muted);
  margin-top:4px;
}

/* =======================
   MAIN
======================= */
main{
  padding:18px;
}

/* =======================
   FILTER TABS
======================= */
.tabs{
  display:flex;
  gap:10px;
  margin-bottom:14px;
}
.tab{
  padding:6px 14px;
  border-radius:999px;
  font-size:13px;
  cursor:pointer;
  background:#1f2937;
}
.tab.active{
  background:var(--accent);
  color:#052e16;
  font-weight:600;
}

/* =======================
   THREAD LIST
======================= */
.thread{
  display:grid;
  grid-template-columns:1fr 130px 160px;
  gap:14px;
  padding:14px;
  border-bottom:1px solid var(--border);
  cursor:pointer;
}
.thread:hover{
  background:var(--panel2);
}

.thread h3{
  margin:0;
  font-size:15px;
  display:flex;
  gap:8px;
  align-items:center;
}

/* BADGES */
.badge{
  font-size:10px;
  padding:2px 6px;
  border-radius:999px;
  white-space:nowrap;
}
.pin{background:#1e3a8a;color:#bfdbfe}
.lock{background:#27272a}
.announcement{background:#1d4ed8}
.update{background:#92400e}
.rfc{background:#065f46}
.incident{background:#7f1d1d}

/* META */
.preview{
  font-size:12px;
  color:var(--muted);
  margin-top:6px;
  max-width:800px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.stats,.activity{
  font-size:12px;
  color:var(--muted);
  text-align:right;
}

/* EMPTY STATE */
.empty{
  padding:80px;
  text-align:center;
  color:var(--muted);
}

/* MOBILE */
@media(max-width:1000px){
  .layout{grid-template-columns:1fr}
  aside{display:none}
  .thread{grid-template-columns:1fr}
  .stats,.activity{text-align:left}
}
</style>
</head>

<body>

<header>
  <div class="brand">
    <h1>StudentStream DevForum</h1>
    <span>Platform ‚Ä¢ Engineering ‚Ä¢ Systems</span>
  </div>
  <input id="search" placeholder="Search DevForum‚Ä¶" />
</header>

<div class="layout">
  <aside id="categoryPanel"></aside>

  <main>
    <div class="tabs">
      <div class="tab active" data-mode="hot">üî• Hot</div>
      <div class="tab" data-mode="new">üïí New</div>
      <div class="tab" data-mode="trending">üìà Trending</div>
    </div>

    <div id="threadList"></div>
  </main>
</div>

<script>
/* =======================
   SUPABASE INIT
======================= */
const supabase = supabase.createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
)

let categories=[]
let threads=[]
let activeCategory=null
let mode="hot"

/* =======================
   LOAD CATEGORIES
======================= */
async function loadCategories(){
  const {data}=await supabase
    .from("forum_categories")
    .select("id,name,description,group,forum_threads(count)")
    .order("order_index",{ascending:true})

  categories=data||[]
  const panel=document.getElementById("categoryPanel")
  panel.innerHTML=""

  const grouped={}
  categories.forEach(c=>{
    grouped[c.group]=grouped[c.group]||[]
    grouped[c.group].push(c)
  })

  Object.keys(grouped).forEach(g=>{
    const wrap=document.createElement("div")
    wrap.className="group"
    wrap.innerHTML=`<div class="group-title">${g}</div>`

    grouped[g].forEach((c,i)=>{
      const d=document.createElement("div")
      d.className="category"
      d.innerHTML=`
        <div class="cat-row">
          <span>${c.name}</span>
          <span>${c.forum_threads?.[0]?.count||0}</span>
        </div>
        <div class="cat-desc">${c.description||""}</div>
      `
      d.onclick=()=>{
        document.querySelectorAll(".category").forEach(x=>x.classList.remove("active"))
        d.classList.add("active")
        activeCategory=c.id
        render()
      }
      if(!activeCategory){
        activeCategory=c.id
        d.classList.add("active")
      }
      wrap.appendChild(d)
    })
    panel.appendChild(wrap)
  })
}

/* =======================
   LOAD THREADS
======================= */
async function loadThreads(){
  const {data}=await supabase
    .from("forum_threads")
    .select(`
      id,title,preview,created_at,last_activity,
      views,is_pinned,is_locked,type,category_id,
      forum_replies(count),
      forum_likes(count)
    `)

  threads=data||[]
  render()
}

/* =======================
   SCORING (V200)
======================= */
function hotScore(t){
  const r=t.forum_replies?.[0]?.count||0
  const l=t.forum_likes?.[0]?.count||0
  const age=(Date.now()-new Date(t.created_at))/36e5
  return (l*2.2 + r*3.1) / Math.max(age,1)
}

/* =======================
   RENDER THREADS
======================= */
function render(){
  const q=document.getElementById("search").value.toLowerCase()
  const el=document.getElementById("threadList")
  el.innerHTML=""

  let list=threads.filter(t=>
    (!activeCategory||t.category_id===activeCategory) &&
    t.title.toLowerCase().includes(q)
  )

  if(mode==="new") list.sort((a,b)=>new Date(b.created_at)-new Date(a.created_at))
  if(mode==="hot") list.sort((a,b)=>hotScore(b)-hotScore(a))
  if(mode==="trending"){
    const cut=Date.now()-12*3600*1000
    list=list.filter(t=>new Date(t.last_activity||t.created_at)>=cut)
    list.sort((a,b)=>hotScore(b)-hotScore(a))
  }

  list.sort((a,b)=>b.is_pinned-a.is_pinned)

  if(!list.length){
    el.innerHTML=`<div class="empty">No threads yet.</div>`
    return
  }

  list.forEach(t=>{
    const replies=t.forum_replies?.[0]?.count||0
    const likes=t.forum_likes?.[0]?.count||0

    const d=document.createElement("div")
    d.className="thread"
    d.innerHTML=`
      <div>
        <h3>
          ${t.is_pinned?'<span class="badge pin">PIN</span>':''}
          ${t.is_locked?'<span class="badge lock">LOCKED</span>':''}
          ${t.type?`<span class="badge ${t.type}">${t.type.toUpperCase()}</span>`:''}
          ${t.title}
        </h3>
        <div class="preview">${t.preview||""}</div>
      </div>
      <div class="stats">
        üëÅÔ∏è ${t.views||0}<br>
        üí¨ ${replies} ¬∑ üëç ${likes}
      </div>
      <div class="activity">
        ${new Date(t.last_activity||t.created_at).toLocaleString()}
      </div>
    `
    d.onclick=()=>location.href="/devforum/thread.html?id="+t.id
    el.appendChild(d)
  })
}

/* =======================
   EVENTS
======================= */
document.getElementById("search").addEventListener("input",render)
document.querySelectorAll(".tab").forEach(tab=>{
  tab.onclick=()=>{
    document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"))
    tab.classList.add("active")
    mode=tab.dataset.mode
    render()
  }
})

/* =======================
   INIT
======================= */
loadCategories()
loadThreads()
</script>

</body>
</html>