<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>StudentStreamHQ DevForum</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif;
  background:radial-gradient(circle at top,#0d1b3a,#05070c 60%);
  color:white;
  min-height:100vh;
}

/* HEADER */
header{
  position:sticky;
  top:0;
  z-index:100;
  padding:18px 30px;
  backdrop-filter:blur(16px);
  background:rgba(5,7,12,.75);
  border-bottom:1px solid rgba(255,255,255,.08);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.logo{
  font-size:20px;
  font-weight:900;
  letter-spacing:.5px;
}
.logo span{color:#4da3ff}

.actions{display:flex;gap:12px;align-items:center}

.btn{
  padding:10px 18px;
  border-radius:14px;
  font-weight:800;
  font-size:14px;
  cursor:pointer;
  border:none;
  transition:.2s ease;
}

.btn.primary{
  background:linear-gradient(135deg,#2f6fff,#4da3ff);
  color:white;
}
.btn.secondary{
  background:rgba(255,255,255,.05);
  border:1px solid rgba(255,255,255,.1);
  color:white;
}
.btn:hover{transform:translateY(-2px);opacity:.9}

/* CONTAINER */
.container{
  max-width:1200px;
  margin:60px auto;
  padding:0 24px;
}

/* HERO */
.hero{
  padding:40px;
  border-radius:26px;
  background:linear-gradient(145deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
  border:1px solid rgba(255,255,255,.08);
  margin-bottom:40px;
}

.hero h1{
  font-size:52px;
  font-weight:950;
  margin-bottom:12px;
}

.hero p{
  opacity:.65;
  max-width:800px;
  line-height:1.6;
  margin-bottom:25px;
}

.stats{
  display:flex;
  gap:18px;
  flex-wrap:wrap;
}

.stat{
  padding:14px 20px;
  border-radius:18px;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.08);
}

.stat strong{
  font-size:20px;
  display:block;
}

.stat span{
  font-size:12px;
  opacity:.6;
}

/* SEARCH + TABS */
.topControls{
  display:flex;
  justify-content:space-between;
  align-items:center;
  flex-wrap:wrap;
  gap:16px;
  margin-bottom:25px;
}

.search{
  flex:1;
}

.search input{
  width:100%;
  padding:14px 18px;
  border-radius:16px;
  border:1px solid rgba(255,255,255,.1);
  background:rgba(255,255,255,.04);
  color:white;
  font-size:14px;
}

.tabs{
  display:flex;
  gap:10px;
}

.tab{
  padding:10px 16px;
  border-radius:999px;
  font-weight:700;
  font-size:13px;
  cursor:pointer;
  background:rgba(255,255,255,.04);
  border:1px solid rgba(255,255,255,.08);
  opacity:.6;
}

.tab.active{
  opacity:1;
  background:rgba(77,163,255,.15);
  border-color:rgba(77,163,255,.4);
}

/* GRID */
.grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(300px,1fr));
  gap:20px;
}

/* CARD */
.card{
  padding:22px;
  border-radius:22px;
  background:rgba(255,255,255,.03);
  border:1px solid rgba(255,255,255,.08);
  cursor:pointer;
  transition:.25s ease;
}

.card:hover{
  transform:translateY(-4px);
  border-color:rgba(77,163,255,.4);
}

.card h3{
  font-size:18px;
  margin-bottom:6px;
}

.card p{
  font-size:13px;
  opacity:.6;
  margin-bottom:12px;
}

.meta{
  font-size:12px;
  opacity:.5;
}

/* STATES */
.loading,.empty{
  text-align:center;
  padding:60px 0;
  opacity:.5;
}

footer{
  margin-top:80px;
  padding:40px;
  text-align:center;
  border-top:1px solid rgba(255,255,255,.08);
  opacity:.35;
}
</style>
</head>

<body>

<header>
  <div class="logo">StudentStream <span>DevForum</span></div>
  <div class="actions">
    <button class="btn secondary" id="newTopicBtn">+ Post Topic</button>
    <button class="btn primary" id="accountBtn">Login</button>
  </div>
</header>

<div class="container">

  <div class="hero">
    <h1>Developer Forums</h1>
    <p>
      Platform announcements, creator updates, engineering discussions,
      bug reports, and support for StudentStream.
    </p>

    <div class="stats">
      <div class="stat"><strong id="statTopics">0</strong><span>Total Topics</span></div>
      <div class="stat"><strong id="statReplies">0</strong><span>Total Replies</span></div>
      <div class="stat"><strong id="statCategories">0</strong><span>Categories</span></div>
    </div>
  </div>

  <div class="topControls">
    <div class="search">
      <input id="searchInput" placeholder="Search topics..." />
    </div>
    <div class="tabs">
      <div class="tab active" data-view="categories">Categories</div>
      <div class="tab" data-view="latest">Latest</div>
    </div>
  </div>

  <div id="contentArea"></div>

</div>

<footer>
© 2026 StudentStreamHQ • DevForum
</footer>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

const contentArea = document.getElementById("contentArea");
const tabs = document.querySelectorAll(".tab");

/* AUTH */
async function updateAuth(){
  const { data } = await supabase.auth.getUser();
  const btn = document.getElementById("accountBtn");

  if(data.user){
    btn.textContent="Logout";
    btn.onclick=async()=>{ await supabase.auth.signOut(); location.reload(); };
  } else {
    btn.textContent="Login";
    btn.onclick=()=>location.href="/login.html";
  }
}
updateAuth();

/* STATS */
async function loadStats(){
  const [{count:topics},{count:replies},{count:categories}] = await Promise.all([
    supabase.from("forum_topics").select("*",{count:"exact",head:true}),
    supabase.from("forum_replies").select("*",{count:"exact",head:true}),
    supabase.from("forum_categories").select("*",{count:"exact",head:true})
  ]);

  document.getElementById("statTopics").textContent = topics || 0;
  document.getElementById("statReplies").textContent = replies || 0;
  document.getElementById("statCategories").textContent = categories || 0;
}

/* CATEGORIES */
async function loadCategories(){
  contentArea.innerHTML='<div class="loading">Loading categories...</div>';

  const { data } = await supabase
    .from("forum_categories")
    .select("id,name,description,forum_topics(id)");

  if(!data || data.length===0){
    contentArea.innerHTML='<div class="empty">No categories yet.</div>';
    return;
  }

  let html='<div class="grid">';
  data.forEach(cat=>{
    html+=`
      <div class="card" onclick="location.href='/devforum/category.html?id=${cat.id}'">
        <h3>${cat.name}</h3>
        <p>${cat.description || ""}</p>
        <div class="meta">${cat.forum_topics?.length || 0} topics</div>
      </div>
    `;
  });
  html+='</div>';
  contentArea.innerHTML=html;
}

/* LATEST */
async function loadLatest(){
  contentArea.innerHTML='<div class="loading">Loading topics...</div>';

  const { data } = await supabase
    .from("forum_topics")
    .select("id,title,created_at")
    .order("created_at",{ascending:false})
    .limit(15);

  if(!data || data.length===0){
    contentArea.innerHTML='<div class="empty">No topics yet.</div>';
    return;
  }

  let html='<div class="grid">';
  data.forEach(topic=>{
    html+=`
      <div class="card" onclick="location.href='/devforum/topic.html?id=${topic.id}'">
        <h3>${topic.title}</h3>
        <div class="meta">${new Date(topic.created_at).toLocaleString()}</div>
      </div>
    `;
  });
  html+='</div>';
  contentArea.innerHTML=html;
}

/* SEARCH (debounced) */
let timeout;
document.getElementById("searchInput").addEventListener("input", e=>{
  clearTimeout(timeout);
  timeout=setTimeout(async()=>{
    const q=e.target.value.trim();
    if(!q){ loadLatest(); return; }

    const { data } = await supabase
      .from("forum_topics")
      .select("id,title")
      .ilike("title",`%${q}%`)
      .limit(20);

    if(!data || data.length===0){
      contentArea.innerHTML='<div class="empty">No matches found.</div>';
      return;
    }

    let html='<div class="grid">';
    data.forEach(topic=>{
      html+=`
        <div class="card" onclick="location.href='/devforum/topic.html?id=${topic.id}'">
          <h3>${topic.title}</h3>
        </div>
      `;
    });
    html+='</div>';
    contentArea.innerHTML=html;

  },300);
});

/* TABS */
tabs.forEach(tab=>{
  tab.onclick=()=>{
    tabs.forEach(t=>t.classList.remove("active"));
    tab.classList.add("active");
    if(tab.dataset.view==="categories") loadCategories();
    if(tab.dataset.view==="latest") loadLatest();
  };
});

/* REALTIME */
supabase.channel("forum-live")
.on("postgres_changes",{event:"INSERT",schema:"public",table:"forum_topics"},
  ()=>{ loadStats(); loadLatest(); }
).subscribe();

/* INIT */
loadStats();
loadCategories();
</script>

</body>
</html>