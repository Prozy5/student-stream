<!DOCTYPE html>
<html>
<head><link rel="stylesheet" href="style.css"></head>
<body>

<div class="container">
<div id="info"></div>

<h3>Comments</h3>
<div id="comments"></div>

<textarea id="text"></textarea>
<button onclick="addComment()">Send</button>
</div>

<script src="supabase.js"></script>
<script>
const id=new URLSearchParams(location.search).get("id");

async function load(){
 const {data:caseData}=await supabase.from("cases").select("*").eq("id",id).single();
 info.innerHTML=`<h2>${caseData.title}</h2>Status: ${caseData.status}`;

 const {data:comments}=await supabase.from("case_comments").select("*").eq("case_id",id);
 comments.forEach(c=>{
   document.getElementById("comments").innerHTML+=`<div class="comment">${c.body}</div>`;
 });
}
load();

async function addComment(){
 await supabase.from("case_comments").insert({
  case_id:id,
  body:text.value
 });
 location.reload();
}
</script>
</body>
</html>