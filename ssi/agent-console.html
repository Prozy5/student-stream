<!DOCTYPE html>
<html>
<head>
<title>Agent Console</title>
<style>
body{background:#05070d;color:#dbe7ff;font-family:sans-serif;padding:20px}
input,textarea,button{width:100%;padding:10px;margin:5px;background:#020617;color:white;border:1px solid #334155}
.case{border:1px solid #1e293b;padding:10px;margin:10px}
</style>
</head>
<body>

<h2>Agent Console</h2>
<button onclick="logout()">Logout</button>

<h3>Create Case</h3>
<input id="title" placeholder="Title">
<textarea id="desc" placeholder="Description"></textarea>
<button onclick="createCase()">Create</button>

<h3>Upload Evidence</h3>
<input type="file" id="file">
<input id="caseid" placeholder="Case ID">
<button onclick="upload()">Upload</button>

<div id="cases"></div>

<script type="module">
import { supabase } from "./supabase.js";

const {data:user}=await supabase.auth.getUser();
if(!user.user) location.href="login.html";

async function logout(){
  await supabase.auth.signOut();
  location.href="index.html";
}

async function createCase(){
  await supabase.from("cases").insert({
    title:title.value,
    description:desc.value
  });
  alert("Case created");
  loadCases();
}

async function upload(){
  const f=file.files[0];
  const path=`${Date.now()}_${f.name}`;

  await supabase.storage.from("evidence").upload(path,f);

  await supabase.from("evidence").insert({
    case_id:caseid.value,
    file_url:path
  });

  alert("Uploaded");
}

async function loadCases(){
  const {data}=await supabase.from("cases").select("*");
  cases.innerHTML=data.map(c=>`<div class="case">${c.title} (${c.id})</div>`).join("");
}

const cases=document.getElementById("cases");
loadCases();
</script>

</body>
</html>