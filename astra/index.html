<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>ASTRA Intelligence</title>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<style>
:root{
--bg:#05060d;
--panel:rgba(20,25,50,0.6);
--border:rgba(255,255,255,0.07);
--text:#f4f7ff;
--muted:#8b95c9;
--accent:#4da3ff;
--success:#3cff9c;
}

*{margin:0;padding:0;box-sizing:border-box;font-family:Inter,system-ui}
body{
background:#05060d;
color:var(--text);
overflow-x:hidden;
}

/* Layout */
.dashboard{
display:grid;
grid-template-columns:280px 1fr 400px;
height:100vh;
}

/* Sidebar */
.sidebar{
background:#0b0f1d;
border-right:1px solid var(--border);
padding:30px;
}
.sidebar h2{
font-size:18px;
margin-bottom:30px;
letter-spacing:3px;
}
.sidebar button{
display:block;
width:100%;
margin-bottom:15px;
padding:10px;
background:transparent;
border:1px solid var(--accent);
color:var(--accent);
cursor:pointer;
border-radius:8px;
}

/* Center */
.center{
padding:30px;
overflow:auto;
}
.sectionTitle{
margin-bottom:20px;
color:var(--accent);
letter-spacing:2px;
}

/* Globe */
#globeContainer{
width:100%;
height:300px;
margin-bottom:40px;
}

/* Neural Graph */
#neuralCanvas{
width:100%;
height:200px;
background:black;
border-radius:12px;
margin-bottom:40px;
}

/* Feed */
.feed{
display:grid;
gap:15px;
}
.card{
background:var(--panel);
border:1px solid var(--border);
padding:20px;
border-radius:12px;
}

/* Right Panel */
.right{
background:#0b0f1d;
border-left:1px solid var(--border);
padding:30px;
overflow:auto;
}

.stat{
margin-bottom:30px;
}
.stat b{
font-size:28px;
display:block;
}

.terminal{
background:black;
padding:15px;
border-radius:12px;
font-family:monospace;
font-size:12px;
color:#7ecbff;
height:200px;
overflow:auto;
}
</style>
</head>
<body>

<div class="dashboard">

<!-- SIDEBAR -->
<div class="sidebar">
<h2>ASTRA OS</h2>
<button onclick="createAnomaly()">Simulate Anomaly</button>
<button onclick="evolveBots()">Run Evolution Cycle</button>
<button onclick="clearTerminal()">Clear Logs</button>
</div>

<!-- CENTER -->
<div class="center">

<h3 class="sectionTitle">GLOBAL INTELLIGENCE TRACKER</h3>
<div id="globeContainer"></div>

<h3 class="sectionTitle">NEURAL SIGNAL MAP</h3>
<canvas id="neuralCanvas"></canvas>

<h3 class="sectionTitle">LIVE ANOMALY FEED</h3>
<div class="feed" id="feed"></div>

</div>

<!-- RIGHT PANEL -->
<div class="right">

<div class="stat">
<b id="indexValue">0</b>
Global Intelligence Index
</div>

<div class="stat">
<b id="botCount">0</b>
Active Bots
</div>

<div class="stat">
<b id="generation">0</b>
Current Evolution Generation
</div>

<div class="terminal" id="terminal"></div>

</div>

</div>

<script>

/* ===========================
   SUPABASE CONNECTION
=========================== */

const supabase = window.supabase.createClient(
"https://iabzmoxzbqzcqgypxctr.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

/* ===========================
   TERMINAL
=========================== */

const terminal = document.getElementById("terminal");
function log(msg){
terminal.innerHTML += "> " + msg + "<br>";
terminal.scrollTop = terminal.scrollHeight;
}

/* ===========================
   LOAD ANOMALIES
=========================== */

async function loadAnomalies(){
const { data } = await supabase
.from("anomalies")
.select("*")
.order("created_at", { ascending:false });

document.getElementById("feed").innerHTML="";
data.forEach(renderCard);
updateIndex(data);
}

function renderCard(a){
const div=document.createElement("div");
div.className="card";
div.innerHTML=`
<h4>${a.code}</h4>
<p>${a.description}</p>
<small>Index: ${a.index}</small>
`;
document.getElementById("feed").appendChild(div);
}

/* ===========================
   REALTIME SUBSCRIPTION
=========================== */

supabase.channel('realtime-anomalies')
.on('postgres_changes', { event: '*', schema: 'public', table: 'anomalies' }, payload => {
renderCard(payload.new);
loadAnomalies();
})
.subscribe();

/* ===========================
   AI DESCRIPTION GENERATOR
=========================== */

function generateAIDescription(){
const topics=[
"Solar flare irregularity",
"Deep ocean frequency shift",
"Satellite pattern distortion",
"Unidentified atmospheric burst",
"Magnetic pole fluctuation"
];
return topics[Math.floor(Math.random()*topics.length)] 
+ " detected with nonlinear signal amplification.";
}

/* ===========================
   CREATE ANOMALY
=========================== */

async function createAnomaly(){
const index=(Math.random()*3+6).toFixed(2);
await supabase.from("anomalies").insert({
code:"AST-"+Math.floor(Math.random()*900+100),
description:generateAIDescription(),
index:index
});
log("New anomaly injected.");
}

/* ===========================
   INTELLIGENCE INDEX
=========================== */

function updateIndex(data){
let total=0;
data.forEach(a=> total+=parseFloat(a.index));
const avg = data.length ? (total/data.length).toFixed(2) : 0;
document.getElementById("indexValue").innerText=avg;
}

/* ===========================
   BOT EVOLUTION
=========================== */

let generation=1;

async function evolveBots(){
generation++;
document.getElementById("generation").innerText=generation;
log("Bots evolved to generation "+generation);
}

/* ===========================
   LOAD BOTS
=========================== */

async function loadBots(){
const { data } = await supabase
.from("bots")
.select("*");

document.getElementById("botCount").innerText=data.length;
}

function clearTerminal(){
terminal.innerHTML="";
}

/* ===========================
   NEURAL GRAPH
=========================== */

const neural=document.getElementById("neuralCanvas");
const ctx=neural.getContext("2d");
neural.width=neural.offsetWidth;
neural.height=neural.offsetHeight;

let nodes=[];
for(let i=0;i<30;i++){
nodes.push({x:Math.random()*neural.width,y:Math.random()*neural.height});
}

function drawNeural(){
ctx.clearRect(0,0,neural.width,neural.height);
ctx.fillStyle="white";
nodes.forEach(n=>{
ctx.beginPath();
ctx.arc(n.x,n.y,2,0,Math.PI*2);
ctx.fill();
});
for(let i=0;i<nodes.length;i++){
for(let j=i+1;j<nodes.length;j++){
let dx=nodes[i].x-nodes[j].x;
let dy=nodes[i].y-nodes[j].y;
let dist=Math.sqrt(dx*dx+dy*dy);
if(dist<120){
ctx.strokeStyle="rgba(77,163,255,0.2)";
ctx.beginPath();
ctx.moveTo(nodes[i].x,nodes[i].y);
ctx.lineTo(nodes[j].x,nodes[j].y);
ctx.stroke();
}
}
}
requestAnimationFrame(drawNeural);
}
drawNeural();

/* ===========================
   3D GLOBE
=========================== */

const container=document.getElementById("globeContainer");
const scene=new THREE.Scene();
const camera=new THREE.PerspectiveCamera(75,container.clientWidth/300,0.1,1000);
const renderer=new THREE.WebGLRenderer({alpha:true});
renderer.setSize(container.clientWidth,300);
container.appendChild(renderer.domElement);

const geometry=new THREE.SphereGeometry(1,32,32);
const material=new THREE.MeshBasicMaterial({color:0x4da3ff,wireframe:true});
const globe=new THREE.Mesh(geometry,material);
scene.add(globe);
camera.position.z=3;

function animateGlobe(){
requestAnimationFrame(animateGlobe);
globe.rotation.y+=0.003;
renderer.render(scene,camera);
}
animateGlobe();

/* ===========================
   INIT
=========================== */

loadAnomalies();
loadBots();
log("ASTRA AI OS Online.");

</script>

</body>
</html>