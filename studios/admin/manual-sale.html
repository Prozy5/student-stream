<!DOCTYPE html>
<html lang="en">
<head>
  <!-- =========================================
       ADMIN • MANUAL SALE ENTRY
       manual-sale.html • Manual Payments Mode
       ========================================= -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Admin Manual Sale • Studios</title>
  <meta name="description" content="Admin tool for entering manual marketplace sales before Stripe is live." />

  <style>
    :root{
      --bg:#070A12;
      --panel:#0E1424;
      --text:#EAF0FF;
      --muted:#A9B4D0;
      --line:rgba(255,255,255,0.12);
      --accent:#5DA8FF;
      --good:#31D18B;
      --bad:#FF5C7A;
      --radius:18px;
    }

    body{
      margin:0;
      font-family:system-ui,Segoe UI,Roboto,Arial;
      background:var(--bg);
      color:var(--text);
      padding:22px;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:18px;
    }

    h1{
      font-size:20px;
      font-weight:900;
    }

    a{
      color:var(--muted);
      text-decoration:none;
      font-size:13px;
      font-weight:700;
    }

    .card{
      background:rgba(14,20,36,0.9);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px;
      max-width:520px;
    }

    label{
      display:block;
      font-size:12px;
      color:var(--muted);
      margin:12px 0 6px;
      font-weight:700;
    }

    input,select{
      width:100%;
      padding:12px;
      border-radius:12px;
      border:1px solid var(--line);
      background:#0B1020;
      color:var(--text);
      outline:none;
      font-size:14px;
    }

    input:focus,select:focus{
      border-color:var(--accent);
    }

    button{
      width:100%;
      margin-top:18px;
      padding:14px;
      border:none;
      border-radius:14px;
      font-weight:900;
      font-size:14px;
      cursor:pointer;
      background:linear-gradient(90deg,var(--accent),#7C5CFF);
      color:white;
    }

    button:hover{
      opacity:0.9;
    }

    .msg{
      margin-top:14px;
      font-size:13px;
      font-weight:700;
    }

    .good{color:var(--good);}
    .bad{color:var(--bad);}

    .note{
      margin-top:14px;
      font-size:12px;
      color:var(--muted);
      line-height:1.4;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header>
    <h1>Manual Sale Entry (Admin)</h1>
    <a href="/studios/admin/index.html">← Back to Admin Panel</a>
  </header>

  <!-- FORM -->
  <div class="card">

    <label>Seller ID (Creator UUID)</label>
    <input id="sellerId" placeholder="Paste seller uuid..." />

    <label>Buyer Email</label>
    <input id="buyerEmail" placeholder="buyer@email.com" />

    <label>Product Title</label>
    <input id="productTitle" placeholder="Cinematic Visual Pack" />

    <label>Sale Amount ($)</label>
    <input id="amount" type="number" step="0.01" placeholder="25.00" />

    <label>Status</label>
    <select id="status">
      <option value="pending">Pending (Not Paid Out Yet)</option>
      <option value="paid">Paid (Completed)</option>
    </select>

    <label>Payment Method</label>
    <select id="paymentMethod">
      <option value="manual">Manual Payment</option>
      <option value="stripe">Stripe (Future)</option>
    </select>

    <button id="submitBtn">Confirm Manual Sale</button>

    <p id="message" class="msg"></p>

    <p class="note">
      ⚠️ Use this ONLY until Stripe checkout is active.  
      This logs sales directly into <b>marketplace_sales</b>.
    </p>

  </div>

  <!-- =========================================
       SUPABASE ADMIN INSERT LOGIC
       ========================================= -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SUPABASE_URL = "https://iabzmoxzbqzcqgypxctr.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // DOM
    const sellerId = document.getElementById("sellerId");
    const buyerEmail = document.getElementById("buyerEmail");
    const productTitle = document.getElementById("productTitle");
    const amount = document.getElementById("amount");
    const status = document.getElementById("status");
    const paymentMethod = document.getElementById("paymentMethod");
    const message = document.getElementById("message");
    const submitBtn = document.getElementById("submitBtn");

    // ✅ ADMIN SESSION CHECK
    const { data: sessionData } = await supabase.auth.getSession();

    if (!sessionData.session) {
      window.location.href = "/studios/login.html";
    }

    // ⚠️ ADMIN LOCKDOWN RULE
    // Only YOU should access this page.
    // Later: enforce role-based admin check in Supabase.

    submitBtn.addEventListener("click", async () => {

      message.textContent = "Saving sale...";
      message.className = "msg";

      // Validate
      if (!sellerId.value || !productTitle.value || !amount.value) {
        message.textContent = "Missing required fields.";
        message.classList.add("bad");
        return;
      }

      // Insert sale
      const { error } = await supabase
        .from("marketplace_sales")
        .insert([
          {
            seller_id: sellerId.value,
            buyer_email: buyerEmail.value,
            product_title: productTitle.value,
            amount: parseFloat(amount.value),
            status: status.value,
            payment_method: paymentMethod.value
          }
        ]);

      if (error) {
        message.textContent = "Error: " + error.message;
        message.classList.add("bad");
        return;
      }

      message.textContent = "Manual sale successfully logged.";
      message.classList.add("good");

      // Clear form
      buyerEmail.value = "";
      productTitle.value = "";
      amount.value = "";
    });
  </script>

</body>
</html>