<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Analytics â€” Studios</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;background:#050507;color:#fff;font-family:Inter,system-ui;padding:30px}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:20px}
.box{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);
border-radius:20px;padding:26px}
.box h3{margin:0;font-size:.85rem;opacity:.7}
.box p{margin:10px 0 0;font-size:1.9rem;font-weight:700}
</style>
</head>

<body>
<h1>Studios Analytics</h1>
<p style="opacity:.7">Platform revenue overview</p>

<div class="grid">
  <div class="box"><h3>Total Revenue</h3><p id="rev">$0</p></div>
  <div class="box"><h3>Creator Owed</h3><p id="owed">$0</p></div>
  <div class="box"><h3>Paid Out</h3><p id="paid">$0</p></div>
</div>

<script>
const supabase = supabaseJs.createClient(
 "https://iabzmoxzbqzcqgypxctr.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

(async()=>{
 const {data:{user}} = await supabase.auth.getUser();
 if(!user){location.href="/studios/login";return;}

 const {data:profile} = await supabase
  .from("profiles")
  .select("role")
  .eq("id",user.id)
  .single();

 if(profile?.role!=="admin"){
  location.href="/studios";
  return;
 }

 const {data:sales} = await supabase
  .from("marketplace_sales")
  .select("*");

 let rev=0,owed=0,paid=0;
 sales?.forEach(s=>{
  rev+=Number(s.amount||0);
  s.status==="paid"?paid+=Number(s.creator_cut||0):owed+=Number(s.creator_cut||0);
 });

 revEl.textContent=`$${rev.toFixed(2)}`;
 owed.textContent=`$${owed.toFixed(2)}`;
 paid.textContent=`$${paid.toFixed(2)}`;
})();
</script>
</body>
</html>