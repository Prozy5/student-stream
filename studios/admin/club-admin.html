<!DOCTYPE html>
<html lang="en">
<head>
  <!-- =========================================
       SS-FILMS ‚Äî MONETIZATION CLUB ADMIN PANEL
       club-admin.html
       Owner/Admin Approval Dashboard
       ========================================= -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Monetization Club Admin ‚Ä¢ SS-Films</title>

  <style>
    :root{
      --bg:#070A12;
      --panel:#0E1424;
      --text:#EAF0FF;
      --muted:#A9B4D0;
      --line:rgba(255,255,255,0.10);
      --glow:rgba(120,180,255,0.20);

      --good:#31D18B;
      --bad:#FF5A5A;
      --warn:#FFD35A;

      --radius:18px;
    }

    *{margin:0;padding:0;box-sizing:border-box;}

    body{
      font-family:system-ui,Segoe UI,Roboto;
      background:
        radial-gradient(circle at top, rgba(93,168,255,0.14), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    .wrap{
      max-width:1100px;
      margin:auto;
      padding:40px 18px 90px;
    }

    h1{
      font-size:30px;
      margin-bottom:6px;
    }

    p{
      color:var(--muted);
      margin-bottom:20px;
    }

    .card{
      padding:22px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:rgba(14,20,36,0.82);
      backdrop-filter:blur(14px);
    }

    table{
      width:100%;
      border-collapse:collapse;
      margin-top:16px;
    }

    th,td{
      padding:12px;
      text-align:left;
      border-bottom:1px solid var(--line);
      font-size:14px;
    }

    th{
      color:var(--muted);
      font-weight:800;
    }

    .status{
      font-weight:900;
      text-transform:uppercase;
      font-size:13px;
    }

    .pending{color:var(--warn);}
    .active{color:var(--good);}
    .denied{color:var(--bad);}

    .btn{
      padding:8px 12px;
      border-radius:10px;
      border:none;
      cursor:pointer;
      font-weight:800;
      margin-right:6px;
      transition:0.15s;
    }

    .approve{
      background:rgba(49,209,139,0.18);
      color:var(--good);
    }

    .deny{
      background:rgba(255,90,90,0.18);
      color:var(--bad);
    }

    .btn:hover{
      transform:translateY(-2px);
      box-shadow:0 0 0 3px var(--glow);
    }

    .toplink{
      display:inline-block;
      margin-bottom:18px;
      text-decoration:none;
      color:var(--muted);
      font-weight:700;
    }
  </style>
</head>

<body>
<div class="wrap">

  <a class="toplink" href="/studios/dashboard.html">‚Üê Back to Dashboard</a>

  <div class="card">
    <h1>üé¨ Monetization Club Applications</h1>
    <p>
      Owner/Admin Panel ‚Äî Approve creators manually.
      <br>
      Payments are handled outside the platform for now.
    </p>

    <table>
      <thead>
        <tr>
          <th>Creator</th>
          <th>Status</th>
          <th>Applied</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="appsTable">
        <tr><td colspan="4">Loading applications...</td></tr>
      </tbody>
    </table>
  </div>

</div>

<!-- =========================================
     SUPABASE ADMIN CLUB APPROVAL SYSTEM
     ========================================= -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const SUPABASE_URL = "https://iabzmoxzbqzcqgypxctr.supabase.co";
  const SUPABASE_ANON_KEY =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const appsTable = document.getElementById("appsTable");

  // SESSION CHECK
  const { data: sessionData } = await supabase.auth.getSession();
  if (!sessionData.session){
    window.location.href="/studios/login.html";
  }

  const userId = sessionData.session.user.id;

  // ROLE CHECK (ADMIN ONLY)
  const { data: profile } = await supabase
    .from("profiles")
    .select("role")
    .eq("id", userId)
    .single();

  if (!profile || profile.role !== "admin"){
    alert("Access denied. Admins only.");
    window.location.href="/studios/dashboard.html";
  }

  // LOAD APPLICATIONS
  async function loadApps(){

    const { data, error } = await supabase
      .from("monetization_club_members")
      .select(`
        id,
        status,
        applied_at,
        creators (
          display_name
        )
      `)
      .order("applied_at", { ascending:false });

    if (error){
      appsTable.innerHTML =
        `<tr><td colspan="4">Error loading applications.</td></tr>`;
      return;
    }

    if (!data || data.length === 0){
      appsTable.innerHTML =
        `<tr><td colspan="4">No applications yet.</td></tr>`;
      return;
    }

    appsTable.innerHTML = "";

    data.forEach(app => {

      const name = app.creators?.display_name || "Unknown Creator";
      const statusClass = app.status;

      appsTable.innerHTML += `
        <tr>
          <td>${name}</td>
          <td class="status ${statusClass}">${app.status}</td>
          <td>${new Date(app.applied_at).toLocaleString()}</td>
          <td>
            <button class="btn approve" onclick="approve('${app.id}')">
              Approve
            </button>
            <button class="btn deny" onclick="deny('${app.id}')">
              Deny
            </button>
          </td>
        </tr>
      `;
    });
  }

  // APPROVE
  async function approve(id){
    await supabase
      .from("monetization_club_members")
      .update({ status:"active" })
      .eq("id", id);

    alert("Creator approved ‚úÖ");
    loadApps();
  }

  // DENY
  async function deny(id){
    await supabase
      .from("monetization_club_members")
      .update({ status:"denied" })
      .eq("id", id);

    alert("Creator denied ‚ùå");
    loadApps();
  }

  window.approve = approve;
  window.deny = deny;

  loadApps();
</script>

</body>
</html>