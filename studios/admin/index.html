<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Studios Admin — StudentStream</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Admin dashboard for StudentStream Studios." />

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box;font-family:Inter,system-ui,Arial,sans-serif}
body{
margin:0;
background:#040406;
color:#fff;
}
.container{
max-width:1300px;
margin:auto;
padding:70px 20px;
}
h1{
font-size:2.8rem;
margin-bottom:10px;
}
p{opacity:.7}

.badge{
display:inline-block;
background:rgba(122,162,255,.15);
border:1px solid rgba(122,162,255,.3);
color:#7aa2ff;
padding:6px 14px;
border-radius:999px;
font-size:.8rem;
margin-bottom:16px;
}

.section{
margin-top:60px;
}

.card{
background:rgba(255,255,255,.06);
border:1px solid rgba(255,255,255,.12);
border-radius:24px;
padding:30px;
margin-top:20px;
}

table{
width:100%;
border-collapse:collapse;
}
th,td{
padding:14px;
border-bottom:1px solid rgba(255,255,255,.12);
text-align:left;
font-size:.95rem;
}
th{opacity:.6}

button{
padding:8px 16px;
border-radius:999px;
border:1px solid rgba(255,255,255,.25);
background:transparent;
color:#fff;
cursor:pointer;
font-size:.8rem;
margin-right:6px;
}
.approve{border-color:#6cf2c2;color:#6cf2c2}
.reject{border-color:#ff6b6b;color:#ff6b6b}
.pay{border-color:#4caf50;color:#4caf50}

.notice{
margin-top:50px;
opacity:.65;
font-size:.85rem;
}
</style>
</head>

<body>
<div class="container">

<span class="badge">Studios · Admin</span>
<h1>Admin Dashboard</h1>
<p>Manage creators, submissions, and payouts.</p>

<!-- CREATORS -->
<div class="section">
<h2>Creators</h2>

<div class="card">
<table>
<thead>
<tr>
<th>Name</th>
<th>Email</th>
<th>Cash App</th>
<th>Status</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="creatorsTable">
<tr><td colspan="5">Loading…</td></tr>
</tbody>
</table>
</div>
</div>

<!-- SUBMISSIONS -->
<div class="section">
<h2>Submissions</h2>

<div class="card">
<table>
<thead>
<tr>
<th>Title</th>
<th>Creator</th>
<th>Type</th>
<th>Status</th>
<th>Actions</th>
</tr>
</thead>
<tbody id="uploadsTable">
<tr><td colspan="5">Loading…</td></tr>
</tbody>
</table>
</div>
</div>

<!-- SALES -->
<div class="section">
<h2>Sales & Payouts</h2>

<div class="card">
<table>
<thead>
<tr>
<th>Asset</th>
<th>Creator</th>
<th>Sale</th>
<th>Creator 70%</th>
<th>Status</th>
<th>Action</th>
</tr>
</thead>
<tbody id="salesTable">
<tr><td colspan="6">Loading…</td></tr>
</tbody>
</table>
</div>
</div>

<div class="notice">
⚠️ Early rollout: approvals & payouts are manual.  
Cash App payouts must be sent before marking as paid.
</div>

</div>

<script>
const supabase = supabaseJs.createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

// ---------- LOAD CREATORS ----------
async function loadCreators(){
  const { data } = await supabase
    .from("creators")
    .select("id, display_name, email, cashapp_tag, approved");

  const tbody = document.getElementById("creatorsTable");
  tbody.innerHTML = "";

  data.forEach(c=>{
    tbody.innerHTML += `
      <tr>
        <td>${c.display_name || "—"}</td>
        <td>${c.email || "—"}</td>
        <td>${c.cashapp_tag || "—"}</td>
        <td>${c.approved ? "Approved" : "Pending"}</td>
        <td>
          ${!c.approved ? `<button class="approve" onclick="approveCreator('${c.id}')">Approve</button>` : ""}
        </td>
      </tr>
    `;
  });
}

// ---------- LOAD UPLOADS ----------
async function loadUploads(){
  const { data } = await supabase
    .from("creator_uploads")
    .select("id, title, asset_type, status, creators(display_name)");

  const tbody = document.getElementById("uploadsTable");
  tbody.innerHTML = "";

  data.forEach(u=>{
    tbody.innerHTML += `
      <tr>
        <td>${u.title}</td>
        <td>${u.creators?.display_name || "—"}</td>
        <td>${u.asset_type}</td>
        <td>${u.status}</td>
        <td>
          ${u.status === "pending" ? `
            <button class="approve" onclick="approveUpload('${u.id}')">Approve</button>
            <button class="reject" onclick="rejectUpload('${u.id}')">Reject</button>
          ` : "—"}
        </td>
      </tr>
    `;
  });
}

// ---------- LOAD SALES ----------
async function loadSales(){
  const { data } = await supabase
    .from("marketplace_sales")
    .select("id, asset_title, sale_price_cents, creator_share_cents, paid, creators(display_name)");

  const tbody = document.getElementById("salesTable");
  tbody.innerHTML = "";

  data.forEach(s=>{
    tbody.innerHTML += `
      <tr>
        <td>${s.asset_title}</td>
        <td>${s.creators?.display_name || "—"}</td>
        <td>$${(s.sale_price_cents/100).toFixed(2)}</td>
        <td>$${(s.creator_share_cents/100).toFixed(2)}</td>
        <td>${s.paid ? "Paid" : "Pending"}</td>
        <td>
          ${!s.paid ? `<button class="pay" onclick="markPaid('${s.id}')">Mark Paid</button>` : "—"}
        </td>
      </tr>
    `;
  });
}

// ---------- ACTIONS ----------
async function approveCreator(id){
  await supabase.from("creators").update({ approved:true }).eq("id",id);
  loadCreators();
}

async function approveUpload(id){
  await supabase.from("creator_uploads").update({ status:"approved" }).eq("id",id);
  loadUploads();
}

async function rejectUpload(id){
  await supabase.from("creator_uploads").update({ status:"rejected" }).eq("id",id);
  loadUploads();
}

async function markPaid(id){
  await supabase.from("marketplace_sales").update({ paid:true }).eq("id",id);
  loadSales();
}

loadCreators();
loadUploads();
loadSales();
</script>

</body>
</html>