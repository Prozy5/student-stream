<!DOCTYPE html>
<html lang="en">
<head>
  <!-- =========================================
       STUDIOS ADMIN HQ PANEL
       index.html ‚Ä¢ Role Locked
       ========================================= -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Admin HQ ‚Ä¢ Studios</title>
  <meta name="description" content="Studios Admin HQ ‚Äî manage creators, payouts, and marketplace sales." />

  <style>
    :root{
      --bg:#070A12;
      --panel:#0E1424;
      --text:#EAF0FF;
      --muted:#A9B4D0;
      --line:rgba(255,255,255,0.12);
      --accent:#5DA8FF;
      --accent2:#7C5CFF;
      --good:#31D18B;
      --bad:#FF5C7A;
      --radius:18px;
    }

    body{
      margin:0;
      font-family:system-ui,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(circle at top, rgba(93,168,255,0.15), transparent 60%),
        radial-gradient(circle at right, rgba(124,92,255,0.12), transparent 60%),
        var(--bg);
      color:var(--text);
      padding:26px;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:24px;
    }

    h1{
      font-size:22px;
      font-weight:900;
    }

    .logout{
      border:none;
      padding:10px 16px;
      border-radius:12px;
      cursor:pointer;
      font-weight:800;
      background:rgba(255,255,255,0.08);
      color:var(--text);
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
      gap:16px;
      margin-top:20px;
    }

    .card{
      background:rgba(14,20,36,0.88);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px;
      transition:0.25s;
      cursor:pointer;
    }

    .card:hover{
      transform:translateY(-4px);
      border-color:rgba(93,168,255,0.4);
    }

    .title{
      font-size:15px;
      font-weight:900;
      margin-bottom:6px;
    }

    .desc{
      font-size:13px;
      color:var(--muted);
      line-height:1.4;
    }

    .badge{
      display:inline-block;
      margin-top:10px;
      padding:5px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:800;
      background:rgba(255,197,92,0.15);
      color:#FFC55C;
    }

    .statusBox{
      margin-top:18px;
      padding:14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.12);
      background:rgba(255,255,255,0.04);
      font-size:13px;
      color:var(--muted);
      line-height:1.4;
    }

    .error{
      margin-top:20px;
      color:var(--bad);
      font-weight:800;
      display:none;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header>
    <h1>Studios Admin HQ</h1>
    <button class="logout" id="logoutBtn">Log Out</button>
  </header>

  <p style="color:var(--muted);max-width:720px;font-size:14px;">
    Welcome to the internal Studios control center.  
    Marketplace sales are currently operating in <b>manual payout mode</b> until Stripe is enabled.
  </p>

  <!-- ADMIN CARDS -->
  <section class="grid">

    <!-- Manual Sale -->
    <div class="card" onclick="location.href='/studios/admin/manual-sale.html'">
      <div class="title">Manual Sale Entry</div>
      <div class="desc">
        Log marketplace sales manually while Stripe checkout is offline.
      </div>
      <span class="badge">Manual Payments Active</span>
    </div>

    <!-- Analytics -->
    <div class="card" onclick="location.href='/studios/admin/analytics.html'">
      <div class="title">Revenue Analytics</div>
      <div class="desc">
        Track total revenue, creator owed, paid vs unpaid balances.
      </div>
    </div>

    <!-- Creator Directory -->
    <div class="card" onclick="location.href='/studios/admin/creators.html'">
      <div class="title">Creator Directory</div>
      <div class="desc">
        View creator accounts, IDs, and submission history.
      </div>
    </div>

    <!-- Marketplace Listings -->
    <div class="card" onclick="location.href='/studios/marketplace.html'">
      <div class="title">Marketplace Listings</div>
      <div class="desc">
        View the public Studios marketplace as users see it.
      </div>
    </div>

  </section>

  <!-- STATUS -->
  <div class="statusBox">
    ‚ö†Ô∏è Stripe checkout is not yet enabled.<br>
    All payouts are tracked manually inside Supabase until automation goes live.
  </div>

  <p id="errorBox" class="error"></p>

  <!-- =========================================
       SUPABASE ADMIN ROLE LOCK
       ========================================= -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SUPABASE_URL = "https://iabzmoxzbqzcqgypxctr.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const errorBox = document.getElementById("errorBox");
    const logoutBtn = document.getElementById("logoutBtn");

    // ‚úÖ REQUIRE LOGIN
    const { data: sessionData } = await supabase.auth.getSession();

    if (!sessionData.session) {
      window.location.href = "/studios/login.html";
    }

    const user = sessionData.session.user;

    // ‚úÖ ROLE CHECK
    const { data: profile, error } = await supabase
      .from("profiles")
      .select("role")
      .eq("id", user.id)
      .single();

    if (error || !profile) {
      errorBox.style.display = "block";
      errorBox.textContent = "Profile role missing. Access denied.";
      throw new Error("No profile role.");
    }

    if (profile.role !== "admin") {
      // üö´ Not admin ‚Üí redirect out
      window.location.href = "/studios/index.html";
    }

    // ‚úÖ LOGOUT
    logoutBtn.addEventListener("click", async () => {
      await supabase.auth.signOut();
      window.location.href = "/studios/login.html";
    });
  </script>

</body>
</html>