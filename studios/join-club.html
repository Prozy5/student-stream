<!DOCTYPE html>
<html lang="en">
<head>
  <!-- =========================================
       SS-FILMS ‚Äî JOIN MONETIZATION CLUB
       join-club.html (Manual Payments System)
       ========================================= -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Join Monetization Club ‚Ä¢ SS-Films</title>

  <style>
    :root{
      --bg:#070A12;
      --panel:#0E1424;
      --text:#EAF0FF;
      --muted:#A9B4D0;
      --line:rgba(255,255,255,0.10);
      --glow:rgba(120,180,255,0.22);

      --good:#31D18B;
      --warn:#FFD35A;

      --radius:18px;
    }

    *{margin:0;padding:0;box-sizing:border-box;}

    body{
      font-family:system-ui,Segoe UI,Roboto;
      background:
        radial-gradient(circle at top, rgba(93,168,255,0.14), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    .wrap{
      max-width:900px;
      margin:auto;
      padding:40px 18px 90px;
    }

    .card{
      padding:26px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:rgba(14,20,36,0.80);
      backdrop-filter:blur(14px);
    }

    h1{
      font-size:30px;
      margin-bottom:10px;
    }

    p{
      color:var(--muted);
      margin-bottom:16px;
      line-height:1.5;
    }

    .badge{
      display:inline-block;
      padding:7px 12px;
      border-radius:999px;
      background:rgba(49,209,139,0.15);
      color:var(--good);
      font-weight:800;
      font-size:13px;
      margin-bottom:16px;
    }

    .btn{
      width:100%;
      padding:14px;
      border-radius:14px;
      border:none;
      cursor:pointer;
      font-weight:900;
      font-size:15px;
      background:rgba(120,180,255,0.18);
      color:var(--text);
      transition:0.2s;
    }

    .btn:hover{
      transform:translateY(-2px);
      box-shadow:0 0 0 4px var(--glow);
    }

    .info{
      margin-top:20px;
      padding:14px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,0.03);
      font-size:14px;
      color:var(--muted);
    }

    .statusBox{
      margin-top:18px;
      padding:14px;
      border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,0.03);
      font-size:14px;
    }

    .pending{color:var(--warn);font-weight:900;}
    .active{color:var(--good);font-weight:900;}

    .toplink{
      display:inline-block;
      margin-bottom:18px;
      text-decoration:none;
      color:var(--muted);
      font-weight:700;
    }
  </style>
</head>

<body>
<div class="wrap">

  <a class="toplink" href="/studios/index.html">‚Üê Back to Studios</a>

  <div class="card">
    <span class="badge">SS-Films Monetization Club</span>

    <h1>Join the Monetization Club</h1>

    <p>
      The Monetization Club is how creators start earning inside
      <b>SS-Films</b>.
    </p>

    <p>
      Once approved, you‚Äôll unlock:
      <br>üé¨ Paid film opportunities  
      <br>üí∞ Creator payouts from sales + ads  
      <br>‚úÖ Verified Monetized Badge  
      <br>üöÄ Priority promotion on StudentStream
    </p>

    <div class="info">
      ‚ö†Ô∏è <b>Manual Payments Right Now:</b><br>
      This is early access. Club entry fees + payouts are handled manually
      until Stripe automation is added.
    </div>

    <br>

    <button class="btn" onclick="applyToClub()">
      Apply to Join Monetization Club
    </button>

    <div id="statusBox" class="statusBox" style="display:none;"></div>
  </div>

</div>

<!-- =========================================
     SUPABASE CLUB APPLICATION SYSTEM
     ========================================= -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const SUPABASE_URL = "https://iabzmoxzbqzcqgypxctr.supabase.co";
  const SUPABASE_ANON_KEY =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ";

  const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const statusBox = document.getElementById("statusBox");

  function showStatus(html){
    statusBox.style.display="block";
    statusBox.innerHTML = html;
  }

  // SESSION CHECK
  const { data: sessionData } = await supabase.auth.getSession();

  if (!sessionData.session){
    window.location.href="/studios/login.html";
  }

  const userId = sessionData.session.user.id;

  // GET CREATOR PROFILE
  const { data: creator } = await supabase
    .from("creators")
    .select("*")
    .eq("user_id", userId)
    .single();

  if (!creator){
    showStatus("‚ùå You must create a Creator profile first.");
  }

  // CHECK CLUB STATUS
  async function checkStatus(){
    const { data } = await supabase
      .from("monetization_club_members")
      .select("*")
      .eq("creator_id", creator.id)
      .single();

    if (!data) return;

    if (data.status === "pending"){
      showStatus("‚è≥ Application Status: <span class='pending'>PENDING</span>");
    }

    if (data.status === "active"){
      showStatus("‚úÖ Application Status: <span class='active'>APPROVED</span><br><br>Welcome to Monetization Club!");
    }
  }

  checkStatus();

  // APPLY FUNCTION
  async function applyToClub(){

    // prevent duplicates
    const { data: existing } = await supabase
      .from("monetization_club_members")
      .select("id,status")
      .eq("creator_id", creator.id)
      .single();

    if (existing){
      alert("You already applied or are already a member.");
      return;
    }

    await supabase
      .from("monetization_club_members")
      .insert({
        creator_id: creator.id,
        status: "pending"
      });

    alert("Application sent! üé¨");
    location.reload();
  }

  window.applyToClub = applyToClub;
</script>

</body>
</html>