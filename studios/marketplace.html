<!DOCTYPE html>
<html lang="en">
<head>
  <!-- =========================================
       STUDIOS PUBLIC MARKETPLACE (LIVE)
       marketplace.html • Supabase Listings
       Manual Purchase Requests (No Stripe Yet)
       ========================================= -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Marketplace • Studios</title>
  <meta name="description" content="Browse licensed creative assets, design packs, visuals, and production-ready work from Studios creators." />

  <style>
    :root{
      --bg:#070A12;
      --panel:#0E1424;
      --text:#EAF0FF;
      --muted:#A9B4D0;
      --line:rgba(255,255,255,0.12);
      --accent:#5DA8FF;
      --radius:20px;
    }

    body{
      margin:0;
      font-family:system-ui,Segoe UI,Roboto,Arial;
      background:
        radial-gradient(circle at top, rgba(93,168,255,0.14), transparent 65%),
        radial-gradient(circle at right, rgba(124,92,255,0.10), transparent 65%),
        var(--bg);
      color:var(--text);
      padding:24px;
    }

    header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:18px;
    }

    h1{
      font-size:24px;
      font-weight:900;
    }

    a{
      color:var(--muted);
      font-size:13px;
      font-weight:700;
      text-decoration:none;
    }

    .notice{
      margin-top:14px;
      padding:14px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,0.10);
      background:rgba(255,255,255,0.04);
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
      max-width:800px;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:18px;
      margin-top:26px;
    }

    .card{
      background:rgba(14,20,36,0.88);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px;
      transition:.25s;
    }

    .card:hover{
      transform:translateY(-6px);
      border-color:rgba(93,168,255,0.4);
    }

    .title{
      font-size:16px;
      font-weight:900;
      margin-bottom:6px;
    }

    .desc{
      font-size:13px;
      color:var(--muted);
      line-height:1.4;
      margin-bottom:12px;
    }

    .meta{
      display:flex;
      justify-content:space-between;
      font-size:12px;
      color:var(--muted);
      margin-bottom:12px;
    }

    .price{
      font-size:15px;
      font-weight:900;
      color:var(--accent);
    }

    button{
      width:100%;
      border:none;
      padding:12px;
      border-radius:14px;
      font-weight:800;
      cursor:pointer;
      background:linear-gradient(135deg,var(--accent),#7C5CFF);
      color:white;
      font-size:13px;
    }

    .empty{
      margin-top:40px;
      color:var(--muted);
      font-weight:800;
    }
  </style>
</head>

<body>

  <!-- HEADER -->
  <header>
    <h1>Studios Marketplace</h1>
    <a href="/studios/index.html">← Back to Studios</a>
  </header>

  <p style="color:var(--muted);max-width:780px;">
    Browse licensed creative assets, production packs, visuals, and digital work.
  </p>

  <!-- Manual checkout notice -->
  <div class="notice">
    <b>Manual Purchase Requests Active</b><br>
    Checkout is currently handled manually while Stripe integration is being prepared.
    Click “Request Purchase” and the Studios team will contact you.
  </div>

  <!-- Listings Grid -->
  <section class="grid" id="listingGrid">
    <p class="empty">Loading marketplace…</p>
  </section>

  <!-- =========================================
       SUPABASE LISTINGS FETCH
       ========================================= -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SUPABASE_URL = "https://iabzmoxzbqzcqgypxctr.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const grid = document.getElementById("listingGrid");

    // Load listings
    const { data: listings, error } = await supabase
      .from("marketplace_listings")
      .select("*")
      .eq("status", "active")
      .order("created_at", { ascending: false });

    if (error) {
      grid.innerHTML = `<p class="empty">Error loading marketplace.</p>`;
      console.error(error);
      throw error;
    }

    if (!listings || listings.length === 0) {
      grid.innerHTML = `<p class="empty">No listings yet. Check back soon.</p>`;
    } else {
      grid.innerHTML = "";

      listings.forEach(item => {
        grid.innerHTML += `
          <div class="card">
            <div class="title">${item.title}</div>
            <div class="desc">${item.description || "No description provided."}</div>

            <div class="meta">
              <span>${item.category}</span>
              <span class="price">$${item.price.toFixed(2)}</span>
            </div>

            <button onclick="requestPurchase('${item.title}', '${item.id}')">
              Request Purchase
            </button>
          </div>
        `;
      });
    }

    // Manual purchase request
    window.requestPurchase = (title, id) => {
      alert(
        "Purchase Request Submitted!\n\n" +
        "Item: " + title + "\n" +
        "Listing ID: " + id + "\n\n" +
        "Studios will contact you manually for payment + delivery."
      );
    };
  </script>

</body>
</html>