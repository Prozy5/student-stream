<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Studios Marketplace • StudentStream HQ</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    :root{
      --bg:#05060C;
      --panel:#0E1424;
      --text:#ECF2FF;
      --muted:#A9B4D0;
      --line:rgba(255,255,255,0.12);
      --accent:#5DA8FF;
      --radius:22px;
    }

    *{
      margin:0;
      padding:0;
      box-sizing:border-box;
      font-family:system-ui,Segoe UI,Roboto;
    }

    body{
      background:
        radial-gradient(circle at top, rgba(93,168,255,0.18), transparent 70%),
        var(--bg);
      color:var(--text);
      padding:26px;
    }

    .wrap{
      max-width:820px;
      margin:auto;
    }

    h1{
      font-size:34px;
      font-weight:1000;
      margin-bottom:10px;
    }

    .sub{
      color:var(--muted);
      margin-bottom:24px;
      line-height:1.5;
    }

    .notice{
      padding:18px;
      border-radius:18px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.10);
      margin-bottom:25px;
    }

    .notice b{
      display:block;
      margin-bottom:6px;
    }

    .card{
      padding:22px;
      border-radius:var(--radius);
      border:1px solid var(--line);
      background:rgba(14,20,36,0.80);
      margin-bottom:20px;
    }

    .card h2{
      font-size:18px;
      font-weight:900;
      margin-bottom:8px;
    }

    .priceRow{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-top:14px;
      color:var(--muted);
      font-size:14px;
    }

    .price{
      font-weight:1000;
      font-size:18px;
      color:var(--accent);
    }

    .btn{
      width:100%;
      margin-top:16px;
      padding:14px;
      border:none;
      border-radius:999px;
      font-weight:900;
      cursor:pointer;
      font-size:14px;
      background:linear-gradient(135deg,var(--accent),#7C5CFF);
      color:white;
    }

    /* MODAL */
    .modal{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.65);
      display:none;
      justify-content:center;
      align-items:center;
      z-index:99;
    }

    .modalBox{
      width:92%;
      max-width:520px;
      padding:24px;
      border-radius:22px;
      background:rgba(14,20,36,0.95);
      border:1px solid rgba(255,255,255,0.12);
    }

    .modalBox h3{
      font-size:18px;
      font-weight:1000;
      margin-bottom:6px;
    }

    label{
      display:block;
      margin-top:14px;
      font-size:13px;
      font-weight:800;
    }

    input, textarea{
      width:100%;
      margin-top:6px;
      padding:12px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,0.14);
      background:rgba(0,0,0,0.25);
      color:white;
      outline:none;
    }

    textarea{
      resize:none;
      min-height:90px;
    }

    .closeBtn{
      margin-top:14px;
      background:transparent;
      border:1px solid rgba(255,255,255,0.20);
    }

    .success{
      margin-top:14px;
      font-size:13px;
      color:lightgreen;
      font-weight:800;
      display:none;
    }
  </style>
</head>

<body>
<div class="wrap">

  <h1>Studios Marketplace</h1>
  <p class="sub">
    Browse licensed creative assets, production packs, visuals, and digital work.
  </p>

  <div class="notice">
    <b>Manual Purchase Requests Active</b>
    Checkout is currently handled manually while Stripe integration is being prepared.
    Click “Request Purchase” and the Studios team will contact you.
  </div>

  <!-- PRODUCT -->
  <div class="card">
    <h2>Cinematic Visual Pack</h2>
    <p class="sub">
      HQ licensed visuals for productions, creators, and studios.
    </p>

    <div class="priceRow">
      <span>Visual Assets</span>
      <span class="price">$25.00</span>
    </div>

    <button class="btn" onclick="openModal('Cinematic Visual Pack',25)">
      Request Purchase
    </button>
  </div>

</div>

<!-- MODAL -->
<div class="modal" id="purchaseModal">
  <div class="modalBox">

    <h3>Request Purchase</h3>
    <p class="sub" id="productText"></p>

    <label>Your Name</label>
    <input id="buyerName" placeholder="Buyer name..." />

    <label>Email Address</label>
    <input id="buyerEmail" placeholder="buyer@email.com" />

    <label>Message / Usage Request</label>
    <textarea id="buyerMessage" placeholder="Tell us how you want to use this licensed pack..."></textarea>

    <button class="btn" onclick="submitRequest()">
      Submit Request →
    </button>

    <button class="btn closeBtn" onclick="closeModal()">
      Cancel
    </button>

    <div class="success" id="successMsg">
      ✅ Request sent. Studios will contact you within 24 hours.
    </div>

  </div>
</div>

<script>
  const SUPABASE_URL = "https://iabzmoxzbqzcqgypxctr.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ";

  const supabase = window.supabase.createClient(
    SUPABASE_URL,
    SUPABASE_ANON_KEY
  );

  let selectedProduct = "";
  let selectedPrice = 0;

  function openModal(product, price){
    selectedProduct = product;
    selectedPrice = price;

    document.getElementById("productText").innerHTML =
      `<b>${product}</b> — $${price}.00<br>Manual checkout request.`;

    document.getElementById("purchaseModal").style.display="flex";
  }

  function closeModal(){
    document.getElementById("purchaseModal").style.display="none";
  }

  async function submitRequest(){
    const name = document.getElementById("buyerName").value;
    const email = document.getElementById("buyerEmail").value;
    const msg = document.getElementById("buyerMessage").value;

    if(!name || !email){
      alert("Enter name + email first.");
      return;
    }

    // Save into Supabase
    await supabase.from("purchase_requests").insert([
      {
        buyer_name: name,
        buyer_email: email,
        product_name: selectedProduct,
        price_usd: selectedPrice,
        message: msg,
        status: "manual_pending"
      }
    ]);

    // Email fallback
    window.location.href =
      `mailto:deondrechambers284@gmail.com?subject=Studios Purchase Request&body=
Buyer: ${name}%0AEmail: ${email}%0AProduct: ${selectedProduct}%0APrice: $${selectedPrice}%0A%0AMessage:%0A${msg}`;

    document.getElementById("successMsg").style.display="block";
  }
</script>

</body>
</html>