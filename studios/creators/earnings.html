<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Earnings — StudentStream Studios</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="description" content="View your earnings, payouts, and sales on StudentStream Studios." />

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box;font-family:Inter,system-ui}
body{
margin:0;
background:#050507;
color:#fff;
padding:30px;
}

.wrapper{max-width:1100px;margin:auto}

h1{font-size:2.6rem;margin-bottom:6px}
p{opacity:.7}

.stats{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:20px;
margin-top:30px;
}

.stat{
background:rgba(255,255,255,.06);
border:1px solid rgba(255,255,255,.12);
border-radius:20px;
padding:26px;
}
.stat h2{margin:0;font-size:2rem}
.stat span{opacity:.6;font-size:.9rem}

.section{margin-top:60px}

.card{
background:rgba(255,255,255,.06);
border:1px solid rgba(255,255,255,.12);
border-radius:20px;
padding:26px;
}

table{
width:100%;
border-collapse:collapse;
margin-top:14px;
}
th,td{
padding:14px;
border-bottom:1px solid rgba(255,255,255,.12);
font-size:.95rem;
text-align:left;
}
th{opacity:.6}

.status{
padding:4px 10px;
border-radius:999px;
font-size:.75rem;
}
.pending{background:rgba(255,193,7,.2);color:#ffc107}
.paid{background:rgba(76,175,80,.25);color:#4caf50}

.notice{
margin-top:40px;
opacity:.65;
font-size:.85rem;
}

.actions{
margin-top:30px;
display:flex;
gap:12px;
flex-wrap:wrap;
}
.actions a{
padding:12px 22px;
border-radius:999px;
border:1px solid rgba(255,255,255,.25);
color:#fff;
text-decoration:none;
font-size:.9rem;
}
.actions a:hover{background:rgba(255,255,255,.08)}
</style>
</head>

<body>
<div class="wrapper">

<h1>Your Earnings</h1>
<p>Track sales, pending payouts, and paid earnings.</p>

<!-- STATS -->
<div class="stats">
  <div class="stat">
    <h2 id="totalEarned">$0.00</h2>
    <span>Total Earned</span>
  </div>
  <div class="stat">
    <h2 id="pending">$0.00</h2>
    <span>Pending Payout</span>
  </div>
  <div class="stat">
    <h2 id="paid">$0.00</h2>
    <span>Total Paid</span>
  </div>
  <div class="stat">
    <h2 id="salesCount">0</h2>
    <span>Total Sales</span>
  </div>
</div>

<!-- SALES TABLE -->
<div class="section">
<h2>Sales History</h2>

<div class="card">
<table>
<thead>
<tr>
  <th>Date</th>
  <th>Sale</th>
  <th>Amount</th>
  <th>Your 70%</th>
  <th>Status</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>
</div>
</div>

<div class="actions">
  <a href="/studios/creators/dashboard.html">Creator Dashboard</a>
  <a href="/studios/creators/submit">Submit New Work</a>
</div>

<div class="notice">
⚠️ Earnings reflect manually recorded and marketplace sales.<br>
Payouts are sent via Cash App after status is marked “Paid”.
</div>

</div>

<script>
const supabase = supabaseJs.createClient(
 "https://iabzmoxzbqzcqgypxctr.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

(async()=>{
 const {data:{user}} = await supabase.auth.getUser();
 if(!user){location.href="/studios/login";return;}

 const {data:sales,error} = await supabase
  .from("marketplace_sales")
  .select("title,amount,creator_cut,status,created_at")
  .eq("creator_id",user.id)
  .order("created_at",{ascending:false});

 if(error){console.error(error);return;}

 let total=0, pending=0, paid=0;

 document.getElementById("salesCount").textContent = sales.length;

 document.getElementById("rows").innerHTML = sales.map(s=>{
  total+=s.creator_cut;
  if(s.status==="paid") paid+=s.creator_cut;
  else pending+=s.creator_cut;

  return `
   <tr>
    <td>${new Date(s.created_at).toLocaleDateString()}</td>
    <td>${s.title}</td>
    <td>$${Number(s.amount).toFixed(2)}</td>
    <td>$${Number(s.creator_cut).toFixed(2)}</td>
    <td>
      <span class="status ${s.status}">
        ${s.status.toUpperCase()}
      </span>
    </td>
   </tr>
  `;
 }).join("");

 document.getElementById("totalEarned").textContent = `$${total.toFixed(2)}`;
 document.getElementById("pending").textContent = `$${pending.toFixed(2)}`;
 document.getElementById("paid").textContent = `$${paid.toFixed(2)}`;
})();
</script>

</body>
</html>