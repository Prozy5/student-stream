<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Earnings — Studios</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{margin:0;background:#050507;color:#fff;font-family:Inter,system-ui;padding:30px}
.wrapper{max-width:1100px;margin:auto}
h1{margin:0 0 8px}
.stats{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:20px;margin:30px 0}
.box{background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:20px;padding:24px}
.box h3{margin:0;font-size:.85rem;opacity:.7}
.box p{margin:10px 0 0;font-size:1.8rem;font-weight:700}
table{width:100%;border-collapse:collapse}
th,td{padding:14px;border-bottom:1px solid rgba(255,255,255,.1);font-size:.9rem}
th{opacity:.6;text-align:left}
.badge{padding:4px 10px;border-radius:999px;font-size:.7rem}
.paid{background:rgba(108,242,194,.2);color:#6cf2c2}
.pending{background:rgba(255,193,7,.18);color:#ffc107}
a{color:#7aa2ff;text-decoration:none}
</style>
</head>

<body>
<div class="wrapper">
<h1>Your Earnings</h1>
<p style="opacity:.7">Live revenue from Studios</p>

<div class="stats">
  <div class="box"><h3>Total Earned</h3><p id="total">$0</p></div>
  <div class="box"><h3>Pending</h3><p id="pending">$0</p></div>
  <div class="box"><h3>Paid Out</h3><p id="paid">$0</p></div>
</div>

<div class="box">
<table>
<thead>
<tr><th>Item</th><th>Date</th><th>Status</th><th>Your Cut</th></tr>
</thead>
<tbody id="rows"><tr><td colspan="4">Loading…</td></tr></tbody>
</table>
</div>

<br><a href="/studios/dashboard.html">← Dashboard</a>
</div>

<script>
const supabase = supabaseJs.createClient(
 "https://iabzmoxzbqzcqgypxctr.supabase.co",
 "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

(async()=>{
 const {data:{user}} = await supabase.auth.getUser();
 if(!user){location.href="/studios/login";return;}

 const {data:sales} = await supabase
  .from("marketplace_sales")
  .select("*")
  .eq("creator_id", user.id)
  .order("created_at",{ascending:false});

 let t=0,p=0,pa=0,html="";
 sales?.forEach(s=>{
  const amt=Number(s.creator_cut||0);
  t+=amt; s.status==="paid"?pa+=amt:p+=amt;
  html+=`
   <tr>
    <td>${s.title||"Untitled"}</td>
    <td>${new Date(s.created_at).toLocaleDateString()}</td>
    <td><span class="badge ${s.status}">${s.status}</span></td>
    <td>$${amt.toFixed(2)}</td>
   </tr>`;
 });

 document.getElementById("rows").innerHTML = html||`<tr><td colspan="4">No sales yet</td></tr>`;
 total.textContent=`$${t.toFixed(2)}`;
 pending.textContent=`$${p.toFixed(2)}`;
 paid.textContent=`$${pa.toFixed(2)}`;
})();
</script>
</body>
</html>