<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Earnings — StudentStream Studios</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="View your earnings, sales, and payout history on StudentStream Studios." />

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{box-sizing:border-box;font-family:Inter,system-ui,Arial,sans-serif}
body{
margin:0;
background:#040406;
color:#fff;
}
.container{
max-width:1200px;
margin:auto;
padding:70px 20px;
}
h1{
font-size:2.8rem;
margin-bottom:10px;
}
p{opacity:.75}

.badge{
display:inline-block;
background:rgba(108,242,194,.15);
border:1px solid rgba(108,242,194,.3);
color:#6cf2c2;
padding:6px 14px;
border-radius:999px;
font-size:.8rem;
margin-bottom:16px;
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
gap:20px;
margin-top:30px;
}

.stat{
background:rgba(255,255,255,.06);
border:1px solid rgba(255,255,255,.12);
border-radius:22px;
padding:28px;
}
.stat h2{
margin:0;
font-size:2rem;
}
.stat span{
opacity:.65;
font-size:.9rem;
}

.section{
margin-top:60px;
}
.card{
background:rgba(255,255,255,.06);
border:1px solid rgba(255,255,255,.12);
border-radius:22px;
padding:30px;
margin-top:18px;
}

table{
width:100%;
border-collapse:collapse;
margin-top:10px;
}
th,td{
padding:14px;
border-bottom:1px solid rgba(255,255,255,.12);
text-align:left;
font-size:.95rem;
}
th{opacity:.6}

.status{
padding:4px 10px;
border-radius:999px;
font-size:.75rem;
}
.pending{background:rgba(255,193,7,.2);color:#ffc107}
.paid{background:rgba(76,175,80,.25);color:#4caf50}

.notice{
margin-top:50px;
opacity:.65;
font-size:.85rem;
}
</style>
</head>

<body>
<div class="container">

<span class="badge">Creator · Earnings</span>
<h1>Your Earnings</h1>
<p>
Track your sales, revenue share, and payouts from StudentStream Studios.
</p>

<!-- STATS -->
<div class="grid">
  <div class="stat">
    <h2 id="totalEarned">$0.00</h2>
    <span>Total Earned</span>
  </div>
  <div class="stat">
    <h2 id="totalPaid">$0.00</h2>
    <span>Total Paid</span>
  </div>
  <div class="stat">
    <h2 id="pending">$0.00</h2>
    <span>Pending Payout</span>
  </div>
  <div class="stat">
    <h2 id="sales">0</h2>
    <span>Total Sales</span>
  </div>
</div>

<!-- SALES TABLE -->
<div class="section">
<h2>Sales Breakdown</h2>

<div class="card">
<table>
<thead>
<tr>
<th>Asset</th>
<th>Sale Price</th>
<th>Your 70%</th>
<th>Status</th>
</tr>
</thead>
<tbody id="salesRows">
<tr><td colspan="4">Loading…</td></tr>
</tbody>
</table>
</div>
</div>

<div class="notice">
⚠️ Earnings update after sales are confirmed.  
Payouts are sent manually via Cash App during early rollout.
</div>

</div>

<script>
const supabase = supabaseJs.createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

async function loadEarnings(){
  const { data, error } = await supabase
    .from("creator_earnings") // ← your VIEW
    .select("*")
    .single();

  if(error || !data){
    console.error(error);
    return;
  }

  document.getElementById("totalEarned").innerText =
    `$${(data.total_earned_cents / 100).toFixed(2)}`;

  document.getElementById("totalPaid").innerText =
    `$${(data.total_paid_cents / 100).toFixed(2)}`;

  document.getElementById("pending").innerText =
    `$${(data.pending_cents / 100).toFixed(2)}`;

  document.getElementById("sales").innerText =
    data.total_sales || 0;
}

async function loadSales(){
  const { data, error } = await supabase
    .from("marketplace_sales")
    .select("asset_title, sale_price_cents, creator_share_cents, paid")
    .order("created_at", { ascending:false });

  const tbody = document.getElementById("salesRows");
  tbody.innerHTML = "";

  if(error || !data || data.length === 0){
    tbody.innerHTML = "<tr><td colspan='4'>No sales yet</td></tr>";
    return;
  }

  data.forEach(sale=>{
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${sale.asset_title}</td>
      <td>$${(sale.sale_price_cents / 100).toFixed(2)}</td>
      <td>$${(sale.creator_share_cents / 100).toFixed(2)}</td>
      <td>
        <span class="status ${sale.paid ? "paid" : "pending"}">
          ${sale.paid ? "Paid" : "Pending"}
        </span>
      </td>
    `;
    tbody.appendChild(tr);
  });
}

loadEarnings();
loadSales();
</script>

</body>
</html>