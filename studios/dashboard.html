<!DOCTYPE html>
<html lang="en">
<head>
  <!-- =========================================
       STUDENTSTREAM HQ ‚Äî STUDIOS DASHBOARD
       index.html (V30 ADMIN + HQ UPGRADE)
       ========================================= -->

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <title>Studios Dashboard ‚Ä¢ StudentStream HQ</title>
  <meta name="description" content="StudentStream HQ Studios Dashboard ‚Äî manage listings, earnings, submissions, and payouts." />

  <link rel="canonical" href="https://studentstream.online/studios/" />
  <link rel="icon" href="/favicon.ico"/>

  <!-- =========================================
       STYLE (HQ UI V30)
       ========================================= -->
  <style>
    :root{
      --bg:#070A12;
      --panel:#0E1424;
      --panel2:#101A33;
      --text:#EAF0FF;
      --muted:#A9B4D0;
      --line:rgba(255,255,255,0.08);
      --glow:rgba(120,180,255,0.22);
      --accent:#5DA8FF;
      --accent2:#7C5CFF;
      --good:#31D18B;
      --warn:#FFD35A;
      --bad:#FF5C7A;
      --radius:18px;
    }

    *{box-sizing:border-box;margin:0;padding:0;}

    body{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:
        radial-gradient(circle at top, rgba(93,168,255,0.14), transparent 55%),
        radial-gradient(circle at right, rgba(124,92,255,0.10), transparent 55%),
        var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    a{color:inherit;text-decoration:none;}

    .wrap{
      max-width:1300px;
      margin:auto;
      padding:30px 18px 80px;
    }

    /* =========================================
       DASHBOARD GRID LAYOUT
       ========================================= */
    .layout{
      display:grid;
      grid-template-columns:260px 1fr;
      gap:18px;
      margin-top:18px;
    }

    @media(max-width:950px){
      .layout{grid-template-columns:1fr;}
    }

    /* =========================================
       SIDEBAR NAV
       ========================================= */
    .sidebar{
      background:rgba(14,20,36,0.75);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px;
      backdrop-filter: blur(14px);
      height:fit-content;
    }

    .sidebar h3{
      font-size:14px;
      margin-bottom:12px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:1px;
    }

    .navlink{
      display:block;
      padding:12px 14px;
      margin-bottom:10px;
      border-radius:14px;
      border:1px solid transparent;
      background:rgba(255,255,255,0.02);
      transition:0.2s;
      font-weight:600;
    }

    .navlink:hover{
      border-color:rgba(93,168,255,0.35);
      box-shadow:0 0 0 4px var(--glow);
      transform:translateY(-2px);
    }

    /* ADMIN BADGE */
    .adminBadge{
      display:inline-block;
      font-size:12px;
      padding:6px 12px;
      border-radius:999px;
      background:rgba(255,92,122,0.12);
      border:1px solid rgba(255,92,122,0.25);
      color:#ff5c7a;
      margin-bottom:12px;
      font-weight:700;
    }

    /* =========================================
       TOPBAR
       ========================================= */
    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:18px 20px;
      background:rgba(14,20,36,0.72);
      border:1px solid var(--line);
      border-radius:var(--radius);
      backdrop-filter: blur(14px);
    }

    .brand h1{
      font-size:18px;
      font-weight:800;
    }

    .brand p{
      font-size:13px;
      color:var(--muted);
    }

    .userbox{
      display:flex;
      align-items:center;
      gap:10px;
    }

    .pill{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid var(--line);
      background:rgba(255,255,255,0.03);
      font-size:13px;
      color:var(--muted);
    }

    .btn{
      padding:10px 14px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,0.04);
      color:var(--text);
      cursor:pointer;
      transition:0.2s;
      font-weight:700;
    }

    .btn:hover{
      transform:translateY(-1px);
      border-color:rgba(93,168,255,0.35);
      box-shadow:0 0 0 4px var(--glow);
    }

    /* =========================================
       KPI STATS
       ========================================= */
    .stats{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(180px,1fr));
      gap:14px;
      margin-top:18px;
    }

    .stat{
      padding:16px;
      border-radius:18px;
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(93,168,255,0.10), rgba(255,255,255,0.02));
    }

    .stat b{
      font-size:18px;
      display:block;
      margin-bottom:4px;
    }

    .stat span{
      font-size:13px;
      color:var(--muted);
    }

    /* Banner */
    .banner{
      margin-top:18px;
      padding:16px 18px;
      border-radius:var(--radius);
      border:1px solid rgba(255,211,90,0.25);
      background:linear-gradient(90deg, rgba(255,211,90,0.12), rgba(93,168,255,0.06));
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
    }

    /* Cards */
    .grid{
      margin-top:18px;
      display:grid;
      grid-template-columns:1.2fr 0.8fr;
      gap:18px;
    }

    @media(max-width:900px){
      .grid{grid-template-columns:1fr;}
    }

    .card{
      background:rgba(14,20,36,0.75);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px;
      backdrop-filter: blur(14px);
    }

    .muted{
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }

    .actions{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px;
      margin-top:12px;
    }

    .action{
      padding:14px;
      border-radius:16px;
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(93,168,255,0.10), rgba(255,255,255,0.02));
      transition:0.2s;
    }

    .action:hover{
      border-color:rgba(93,168,255,0.35);
      transform:translateY(-2px);
    }

    /* Listings */
    .listing{
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      margin-top:10px;
      background:rgba(255,255,255,0.02);
      display:flex;
      justify-content:space-between;
      gap:10px;
    }

    footer{
      margin-top:22px;
      text-align:center;
      color:var(--muted);
      font-size:12px;
    }
  </style>
</head>

<body>
  <div class="wrap">

    <!-- TOPBAR -->
    <div class="topbar">
      <div class="brand">
        <h1>StudentStream HQ ‚Ä¢ Studios</h1>
        <p>Dashboard Control Center</p>
      </div>

      <div class="userbox">
        <div class="pill" id="userEmail">Loading...</div>
        <button class="btn" id="logoutBtn">Logout</button>
      </div>
    </div>

    <!-- KPI STATS -->
    <div class="stats">
      <div class="stat">
        <b id="statListings">0</b>
        <span>Active Listings</span>
      </div>
      <div class="stat">
        <b>$<span id="statEarnings">0</span></b>
        <span>Total Earnings</span>
      </div>
      <div class="stat">
        <b id="statPayouts">Manual</b>
        <span>Payout Mode</span>
      </div>
    </div>

    <!-- PAYOUT NOTICE -->
    <div class="banner">
      <div>
        <strong>Manual Payouts Active</strong>
        <span>Stripe automated payouts are coming soon.</span>
      </div>
      <a class="btn" href="/studios/admin/payouts.html">View Payouts</a>
    </div>

    <!-- DASHBOARD LAYOUT -->
    <div class="layout">

      <!-- SIDEBAR -->
      <div class="sidebar">
        <h3>Studios Menu</h3>

        <a class="navlink" href="/studios/index.html">üè† Dashboard Home</a>
        <a class="navlink" href="/studios/marketplace.html">üõí Marketplace</a>
        <a class="navlink" href="/studios/submit.html">‚ûï Submit Listing</a>
        <a class="navlink" href="/studios/earnings.html">üí∞ Earnings</a>
        <a class="navlink" href="/studios/admin/manual-sale.html">üßæ Manual Sale</a>

        <!-- ADMIN SECTION (ROLE LOCKED) -->
        <div id="adminSection" style="display:none; margin-top:20px;">

          <span class="adminBadge">ADMIN ACCESS ENABLED</span>

          <h3>Admin Panel</h3>

          <a class="navlink" href="/studios/admin/payouts.html">
            üí∏ Creator Payout Center
          </a>

          <a class="navlink" href="/studios/admin/withdrawals.html">
            üè¶ Withdrawal Requests
          </a>

          <a class="navlink" href="/studios/admin/sales-log.html">
            üìä Marketplace Sales Log
          </a>

        </div>
      </div>

      <!-- MAIN GRID -->
      <div class="grid">

        <!-- LEFT -->
        <div class="card">
          <h2>Studio Actions</h2>
          <p class="muted">
            Manage listings, submissions, earnings, and marketplace activity inside StudentStream HQ.
          </p>

          <div class="actions">
            <a class="action" href="/studios/marketplace.html">
              <b>Marketplace</b>
              <small>Browse & manage listings</small>
            </a>

            <a class="action" href="/studios/submit.html">
              <b>Submit Listing</b>
              <small>Upload a new studio product</small>
            </a>

            <a class="action" href="/studios/earnings.html">
              <b>Earnings</b>
              <small>Track sales & payouts</small>
            </a>

            <a class="action" href="/studios/admin/manual-sale.html">
              <b>Manual Sale</b>
              <small>Record offline purchases</small>
            </a>
          </div>

          <h2 style="margin-top:18px;">Live Marketplace Preview</h2>
          <p class="muted">Latest active listings pulled from Supabase.</p>

          <div id="listingsArea">
            <p class="muted" style="margin-top:10px;">Loading listings‚Ä¶</p>
          </div>
        </div>

        <!-- RIGHT -->
        <div class="card">
          <h2>StudentStream HQ Network</h2>
          <p class="muted">
            Studios is the production + marketplace division inside StudentStream HQ.
          </p>

          <h2 style="margin-top:14px;">Platform Status</h2>

          <div class="listing">
            <div>
              <b>Payments</b><br/>
              <span>Manual payouts (Stripe soon)</span>
            </div>
            <span style="color:var(--warn);font-weight:800;">ACTIVE</span>
          </div>

          <div class="listing">
            <div>
              <b>Marketplace</b><br/>
              <span>Supabase connected</span>
            </div>
            <span style="color:var(--good);font-weight:800;">LIVE</span>
          </div>
        </div>

      </div>
    </div>

    <footer>
      ¬© <span id="year"></span> StudentStream HQ ‚Äî Studios Division.
    </footer>

  </div>

  <!-- =========================================
       SUPABASE AUTH + ADMIN ROLE CHECK
       ========================================= -->
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const SUPABASE_URL = "https://iabzmoxzbqzcqgypxctr.supabase.co";
    const SUPABASE_ANON_KEY =
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ";

    const supabase = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    document.getElementById("year").textContent = new Date().getFullYear();

    // SESSION CHECK
    const { data: sessionData } = await supabase.auth.getSession();

    if (!sessionData.session) {
      window.location.href = "/studios/login.html";
    }

    document.getElementById("userEmail").textContent =
      sessionData.session.user.email;

    // LOGOUT
    document.getElementById("logoutBtn").onclick = async () => {
      await supabase.auth.signOut();
      window.location.href = "/studios/login.html";
    };

    // =========================================
    // ADMIN ROLE CHECK
    // =========================================
    const userId = sessionData.session.user.id;

    const { data: profileData } = await supabase
      .from("profiles")
      .select("role")
      .eq("id", userId)
      .single();

    if (profileData?.role === "admin") {
      document.getElementById("adminSection").style.display = "block";
    }

    // =========================================
    // LOAD LISTINGS PREVIEW
    // =========================================
    async function loadListings() {
      const area = document.getElementById("listingsArea");

      const { data, error } = await supabase
        .from("marketplace_listings")
        .select("title, price, status")
        .eq("status", "active")
        .limit(4);

      if (error) {
        area.innerHTML = `<p class="muted">Error loading listings.</p>`;
        return;
      }

      if (!data || data.length === 0) {
        area.innerHTML = `<p class="muted">No listings yet.</p>`;
        return;
      }

      document.getElementById("statListings").textContent = data.length;
      document.getElementById("statEarnings").textContent = "Coming Soon";

      area.innerHTML = "";

      data.forEach(item => {
        const div = document.createElement("div");
        div.className = "listing";

        div.innerHTML = `
          <div>
            <b>${item.title}</b><br/>
            <span>$${Number(item.price).toFixed(2)}</span>
          </div>
          <span style="color:var(--good);font-weight:800;">LIVE</span>
        `;

        area.appendChild(div);
      });
    }

    loadListings();
  </script>

</body>
</html>