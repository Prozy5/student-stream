<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Studios Dashboard ‚Ä¢ StudentStream HQ</title>

  <style>
    :root{
      --bg:#070A12;
      --panel:#0E1424;
      --text:#EAF0FF;
      --muted:#A9B4D0;
      --line:rgba(255,255,255,0.08);
      --glow:rgba(120,180,255,0.22);
      --accent:#5DA8FF;
      --good:#31D18B;
      --warn:#FFD35A;
      --bad:#FF5C7A;
      --radius:18px;
    }

    *{box-sizing:border-box;margin:0;padding:0;}
    body{
      font-family:system-ui;
      background:radial-gradient(circle at top, rgba(93,168,255,0.14), transparent 55%),var(--bg);
      color:var(--text);
      min-height:100vh;
    }

    .wrap{max-width:1350px;margin:auto;padding:30px 18px 80px;}

    .topbar{
      display:flex;justify-content:space-between;align-items:center;
      padding:18px 20px;
      background:rgba(14,20,36,0.72);
      border:1px solid var(--line);
      border-radius:var(--radius);
    }

    .btn{
      padding:10px 14px;
      border-radius:12px;
      border:1px solid var(--line);
      background:rgba(255,255,255,0.04);
      color:var(--text);
      cursor:pointer;
      font-weight:700;
    }

    .layout{
      display:grid;
      grid-template-columns:260px 1fr;
      gap:18px;
      margin-top:18px;
    }

    .sidebar,.card{
      background:rgba(14,20,36,0.75);
      border:1px solid var(--line);
      border-radius:var(--radius);
      padding:18px;
    }

    .navlink{
      display:block;
      padding:12px 14px;
      margin-bottom:10px;
      border-radius:14px;
      background:rgba(255,255,255,0.02);
      font-weight:600;
    }

    .stats{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:14px;
      margin-top:18px;
    }

    .stat{
      padding:16px;
      border-radius:18px;
      border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(93,168,255,0.10), rgba(255,255,255,0.02));
    }

    .stat b{font-size:20px;display:block;}
    .stat span{font-size:13px;color:var(--muted);}

    .listing{
      padding:12px;
      border-radius:14px;
      border:1px solid var(--line);
      margin-top:10px;
      background:rgba(255,255,255,0.02);
      display:flex;
      justify-content:space-between;
    }

    .muted{color:var(--muted);font-size:13px;}
  </style>
</head>

<body>
<div class="wrap">

  <div class="topbar">
    <div>
      <h2>StudentStream Studios</h2>
      <p class="muted">SS-Films Monetization Dashboard</p>
    </div>
    <button class="btn" id="logoutBtn">Logout</button>
  </div>

  <!-- KPI -->
  <div class="stats">
    <div class="stat">
      <b id="earned">$0.00</b>
      <span>Total Earned</span>
    </div>

    <div class="stat">
      <b id="available">$0.00</b>
      <span>Available Balance</span>
    </div>

    <div class="stat">
      <b id="clubStatus">Checking...</b>
      <span>Monetization Club</span>
    </div>

    <div class="stat">
      <b>Manual</b>
      <span>Payout Mode</span>
    </div>
  </div>

  <div class="layout">

    <!-- Sidebar -->
    <div class="sidebar">
      <h3 class="muted">Studios Menu</h3>

      <a class="navlink" href="/studios/index.html">üè† Dashboard</a>
      <a class="navlink" href="/studios/marketplace.html">üõí Marketplace</a>
      <a class="navlink" href="/studios/earnings.html">üí∞ Earnings</a>

      <a class="navlink" href="/studios/join-monetization.html">
        üé¨ Join SS-Films Monetization Club
      </a>

      <a class="navlink" href="/studios/request-withdrawal.html">
        üè¶ Request Withdrawal
      </a>
    </div>

    <!-- Main -->
    <div class="card">
      <h2>Creator Wallet</h2>
      <p class="muted">Real earnings powered by SS-Films Monetization Club.</p>

      <div id="walletBox" style="margin-top:14px;">
        Loading wallet...
      </div>
    </div>

  </div>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

const { data: sessionData } = await supabase.auth.getSession();
if (!sessionData.session) location.href="/studios/login.html";

const user = sessionData.session.user;

document.getElementById("logoutBtn").onclick = async ()=>{
  await supabase.auth.signOut();
  location.href="/studios/login.html";
};

/* LOAD CLUB STATUS */
async function loadClub(){
  const { data } = await supabase
    .from("monetization_club")
    .select("status")
    .eq("user_id", user.id)
    .single();

  if (!data){
    document.getElementById("clubStatus").innerText="NOT JOINED";
    return;
  }

  document.getElementById("clubStatus").innerText=data.status.toUpperCase();
}

/* LOAD WALLET */
async function loadWallet(){
  const { data: creator } = await supabase
    .from("creators")
    .select("id")
    .eq("user_id", user.id)
    .single();

  if (!creator){
    document.getElementById("walletBox").innerHTML =
      "<p class='muted'>Creator profile not found.</p>";
    return;
  }

  const { data: wallet } = await supabase
    .from("creator_wallet_v500")
    .select("*")
    .eq("creator_id", creator.id)
    .single();

  document.getElementById("earned").innerText =
    "$" + (wallet.total_earned_cents/100).toFixed(2);

  document.getElementById("available").innerText =
    "$" + (wallet.available_balance_cents/100).toFixed(2);

  document.getElementById("walletBox").innerHTML = `
    <div class="listing">
      <b>Available Balance</b>
      <span>$${(wallet.available_balance_cents/100).toFixed(2)}</span>
    </div>
  `;
}

loadClub();
loadWallet();
</script>

</body>
</html>