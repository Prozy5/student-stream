<!-- =========================================
     STUDENTSTREAM HQ ‚Äî STUDIOS DASHBOARD
     index.html (V5000 FINANCE UPGRADE)
     + Creator Wallet + Withdraw Requests
     ========================================= -->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Studios Dashboard ‚Ä¢ StudentStream HQ</title>

<style>
  :root{
    --bg:#070A12;
    --panel:#0E1424;
    --text:#EAF0FF;
    --muted:#A9B4D0;
    --line:rgba(255,255,255,0.08);
    --glow:rgba(120,180,255,0.22);
    --accent:#5DA8FF;
    --accent2:#7C5CFF;
    --good:#31D18B;
    --warn:#FFD35A;
    --bad:#FF5C7A;
    --radius:18px;
  }

  *{box-sizing:border-box;margin:0;padding:0;}
  body{
    font-family:system-ui;
    background:
      radial-gradient(circle at top, rgba(93,168,255,0.14), transparent 55%),
      radial-gradient(circle at right, rgba(124,92,255,0.10), transparent 55%),
      var(--bg);
    color:var(--text);
    min-height:100vh;
  }

  .wrap{
    max-width:1300px;
    margin:auto;
    padding:30px 18px 80px;
  }

  .topbar{
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:18px 20px;
    background:rgba(14,20,36,0.72);
    border:1px solid var(--line);
    border-radius:var(--radius);
    backdrop-filter:blur(14px);
  }

  .pill{
    padding:8px 12px;
    border-radius:999px;
    border:1px solid var(--line);
    background:rgba(255,255,255,0.03);
    font-size:13px;
    color:var(--muted);
  }

  .btn{
    padding:10px 14px;
    border-radius:12px;
    border:1px solid var(--line);
    background:rgba(255,255,255,0.04);
    color:var(--text);
    cursor:pointer;
    font-weight:700;
    transition:.2s;
  }

  .btn:hover{
    transform:translateY(-1px);
    border-color:rgba(93,168,255,0.35);
    box-shadow:0 0 0 4px var(--glow);
  }

  .layout{
    display:grid;
    grid-template-columns:260px 1fr;
    gap:18px;
    margin-top:18px;
  }

  @media(max-width:950px){
    .layout{grid-template-columns:1fr;}
  }

  .sidebar{
    background:rgba(14,20,36,0.75);
    border:1px solid var(--line);
    border-radius:var(--radius);
    padding:18px;
  }

  .navlink{
    display:block;
    padding:12px 14px;
    margin-bottom:10px;
    border-radius:14px;
    background:rgba(255,255,255,0.02);
    font-weight:600;
  }

  .navlink:hover{
    border:1px solid rgba(93,168,255,0.35);
    box-shadow:0 0 0 4px var(--glow);
  }

  .grid{
    display:grid;
    grid-template-columns:1.2fr 0.8fr;
    gap:18px;
  }

  @media(max-width:900px){
    .grid{grid-template-columns:1fr;}
  }

  .card{
    background:rgba(14,20,36,0.75);
    border:1px solid var(--line);
    border-radius:var(--radius);
    padding:18px;
    backdrop-filter:blur(14px);
  }

  .muted{color:var(--muted);font-size:13px;}

  .walletBox{
    margin-top:16px;
    padding:16px;
    border-radius:18px;
    border:1px solid rgba(93,168,255,0.25);
    background:linear-gradient(90deg, rgba(93,168,255,0.10), rgba(124,92,255,0.06));
  }

  .walletBox h3{
    font-size:14px;
    margin-bottom:10px;
    color:var(--muted);
    text-transform:uppercase;
    letter-spacing:1px;
  }

  .walletStat{
    display:flex;
    justify-content:space-between;
    margin-bottom:10px;
    font-weight:700;
  }

  .walletStat span{
    color:var(--muted);
    font-weight:600;
  }

  .requestBtn{
    width:100%;
    margin-top:10px;
    padding:12px;
    border-radius:14px;
    border:none;
    font-weight:900;
    cursor:pointer;
    background:linear-gradient(90deg,var(--accent),var(--accent2));
    color:white;
  }

  table{
    width:100%;
    margin-top:14px;
    border-collapse:collapse;
  }

  th,td{
    padding:10px;
    font-size:13px;
    border-bottom:1px solid rgba(255,255,255,0.08);
  }

  th{
    color:var(--muted);
    font-weight:800;
    text-transform:uppercase;
    font-size:11px;
  }

  .status{
    font-weight:900;
    font-size:12px;
  }

  .pending{color:var(--warn);}
  .approved{color:var(--good);}
  .denied{color:var(--bad);}
</style>
</head>

<body>
<div class="wrap">

  <!-- TOPBAR -->
  <div class="topbar">
    <div>
      <h2>Studios Dashboard</h2>
      <p class="muted">Creator Wallet + Withdrawals</p>
    </div>

    <div style="display:flex;gap:10px;align-items:center;">
      <div class="pill" id="userEmail">Loading...</div>
      <button class="btn" id="logoutBtn">Logout</button>
    </div>
  </div>

  <div class="layout">

    <!-- SIDEBAR -->
    <div class="sidebar">
      <a class="navlink" href="/studios/index.html">üè† Dashboard</a>
      <a class="navlink" href="/studios/marketplace.html">üõí Marketplace</a>
      <a class="navlink" href="/studios/submit.html">‚ûï Submit Listing</a>
      <a class="navlink" href="/studios/earnings.html">üí∞ Earnings</a>
    </div>

    <!-- MAIN -->
    <div class="grid">

      <!-- LEFT -->
      <div class="card">
        <h2>Creator Wallet</h2>
        <p class="muted">
          Your Studios earnings are tracked here. Withdrawals are processed manually for now.
        </p>

        <div class="walletBox">
          <h3>Wallet Overview</h3>

          <div class="walletStat">
            <span>Available Balance</span>
            <b id="availableBal">$0.00</b>
          </div>

          <div class="walletStat">
            <span>Pending Balance</span>
            <b id="pendingBal">$0.00</b>
          </div>

          <button class="requestBtn" id="withdrawBtn">
            Request Withdrawal
          </button>
        </div>

        <h3 style="margin-top:20px;">Withdrawal Requests</h3>

        <table>
          <thead>
            <tr>
              <th>Date</th>
              <th>Amount</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="withdrawTable">
            <tr><td colspan="3">Loading‚Ä¶</td></tr>
          </tbody>
        </table>
      </div>

      <!-- RIGHT -->
      <div class="card">
        <h2>Platform Status</h2>
        <p class="muted">
          Withdrawals will become instant once Stripe Connect is enabled.
        </p>

        <div style="margin-top:14px;">
          <b style="color:var(--warn);">Manual Payout Mode Active</b>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- =========================================
     SUPABASE CREATOR WALLET LOGIC
     ========================================= -->
<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

const supabase = createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ"
);

const { data: sessionData } = await supabase.auth.getSession();
if (!sessionData.session) location.href="/studios/login.html";

const user = sessionData.session.user;
document.getElementById("userEmail").textContent = user.email;

document.getElementById("logoutBtn").onclick = async () => {
  await supabase.auth.signOut();
  location.href="/studios/login.html";
};

const withdrawTable = document.getElementById("withdrawTable");

async function loadWallet(){
  // Load creator sales
  const { data: sales } = await supabase
    .from("marketplace_sales")
    .select("*")
    .eq("seller_id", user.id);

  let available = 0;
  let pending = 0;

  sales?.forEach(s=>{
    if(s.status==="paid") available += s.creator_earn_cents;
    if(s.status==="unpaid") pending += s.creator_earn_cents;
  });

  document.getElementById("availableBal").textContent =
    "$" + (available/100).toFixed(2);

  document.getElementById("pendingBal").textContent =
    "$" + (pending/100).toFixed(2);
}

async function loadWithdrawals(){
  const { data } = await supabase
    .from("withdraw_requests")
    .select("*")
    .eq("seller_id", user.id)
    .order("created_at",{ascending:false});

  if(!data || data.length===0){
    withdrawTable.innerHTML =
      `<tr><td colspan="3">No requests yet.</td></tr>`;
    return;
  }

  withdrawTable.innerHTML = data.map(w=>`
    <tr>
      <td>${new Date(w.created_at).toLocaleDateString()}</td>
      <td>$${(w.amount_cents/100).toFixed(2)}</td>
      <td class="status ${w.status}">${w.status.toUpperCase()}</td>
    </tr>
  `).join("");
}

document.getElementById("withdrawBtn").onclick = async ()=>{
  const amt = prompt("Enter withdrawal amount in dollars:");
  if(!amt) return;

  const cents = Math.round(Number(amt)*100);

  await supabase.from("withdraw_requests").insert({
    seller_id:user.id,
    amount_cents:cents,
    status:"pending"
  });

  alert("Withdrawal Request Submitted ‚úÖ");
  loadWithdrawals();
};

loadWallet();
loadWithdrawals();
</script>

</body>
</html>