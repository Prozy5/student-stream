<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>My Cases · StudentStream Law</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- PLATFORM LOCK -->
  <script type="module" src="/js/platform-guard.js"></script>

  <style>
    :root{
      --bg:#060b14;
      --panel:#0c1626;
      --accent:#ff5d5d;
      --text:#eaf1ff;
      --muted:#9fb0cc;
      --border:rgba(255,255,255,0.08);
    }

    *{margin:0;padding:0;box-sizing:border-box}

    body{
      font-family:system-ui,Segoe UI,Roboto;
      background:radial-gradient(circle at top,#0c1b33,#05080f 70%);
      color:var(--text);
    }

    nav{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:18px 24px;
      background:rgba(10,20,40,.75);
      backdrop-filter:blur(10px);
      border-bottom:1px solid var(--border);
    }

    nav h1{
      font-size:16px;
      font-weight:700;
      display:flex;
      align-items:center;
      gap:8px;
    }

    nav a{
      color:var(--muted);
      text-decoration:none;
      font-size:14px;
      margin-left:16px;
    }

    nav a:hover{color:var(--text)}

    .wrap{
      max-width:1100px;
      margin:auto;
      padding:55px 22px;
    }

    .title{
      text-align:center;
      margin-bottom:35px;
    }

    .title h2{
      font-size:38px;
      margin-bottom:10px;
    }

    .title p{
      color:var(--muted);
      max-width:700px;
      margin:auto;
      line-height:1.6;
    }

    .cases{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
      gap:16px;
    }

    .case{
      background:var(--panel);
      border:1px solid var(--border);
      border-radius:14px;
      padding:18px;
      transition:.2s;
    }

    .case:hover{
      transform:translateY(-3px);
      border-color:rgba(255,93,93,0.35);
    }

    .case-top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
    }

    .badge{
      padding:5px 10px;
      border-radius:999px;
      font-size:12px;
      font-weight:600;
      text-transform:capitalize;
    }

    .pending{background:rgba(255,255,255,0.08);color:var(--muted);}
    .reviewing{background:rgba(255,93,93,0.15);color:var(--accent);}
    .resolved{background:rgba(0,255,120,0.12);color:#6dffb0;}

    .case h3{
      font-size:15px;
      margin-bottom:6px;
    }

    .case p{
      color:var(--muted);
      font-size:13px;
      line-height:1.4;
    }

    .empty{
      text-align:center;
      padding:60px;
      color:var(--muted);
    }

    footer{
      text-align:center;
      padding:30px;
      color:var(--muted);
      font-size:13px;
      border-top:1px solid var(--border);
      margin-top:60px;
    }
  </style>
</head>

<body>

<nav>
  <h1>⚖️ StudentStream Law</h1>

  <div>
    <a href="law.html">Home</a>
    <a href="report.html">Report</a>
    <a href="cases.html">My Cases</a>
  </div>
</nav>

<div class="wrap">

  <div class="title">
    <h2>My Law Cases</h2>
    <p>
      These are reports you’ve submitted to StudentStream Law.
      Status updates will appear here as staff review your case.
    </p>
  </div>

  <div id="casesList" class="cases"></div>

  <div id="emptyState" class="empty" style="display:none;">
    No reports found yet.<br>
    Submit one through the Report page.
  </div>

</div>

<footer>
  © 2026 StudentStream Law · Case Transparency System
</footer>

<!-- Supabase -->
<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const supabaseUrl = "https://iabzmoxzbqzcqgypxctr.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjcxMDgzNzAsImV4cCI6MjA4MjY4NDM3MH0.mHke56jh8WSlzzQxa7o2PIxqLRk1eyPRZerJ3avuGkQ";
  const db = createClient(supabaseUrl, supabaseKey);

  const list = document.getElementById("casesList");
  const empty = document.getElementById("emptyState");

  async function loadCases() {

    // Get logged in user
    const { data: { user } } = await db.auth.getUser();

    if (!user) {
      alert("You must be logged in to view your cases.");
      location.href = "../login.html";
      return;
    }

    // Fetch reports submitted by this user
    const { data, error } = await db
      .from("law_reports")
      .select("*")
      .eq("user_id", user.id)
      .order("created_at", { ascending: false });

    if (error) {
      console.error(error);
      alert("Error loading cases.");
      return;
    }

    if (!data || data.length === 0) {
      empty.style.display = "block";
      return;
    }

    data.forEach(report => {

      let statusClass = report.status;

      const div = document.createElement("div");
      div.className = "case";

      div.innerHTML = `
        <div class="case-top">
          <h3>${report.issue_type || "Unknown Issue"}</h3>
          <span class="badge ${statusClass}">
            ${report.status}
          </span>
        </div>

        <p><b>Target:</b> ${report.target || "Not provided"}</p>
        <p style="margin-top:8px;">
          ${report.description?.slice(0, 120) || "No description"}...
        </p>

        <p style="margin-top:12px;font-size:12px;">
          Submitted: ${new Date(report.created_at).toLocaleString()}
        </p>
      `;

      list.appendChild(div);
    });
  }

  loadCases();
</script>

</body>
</html>