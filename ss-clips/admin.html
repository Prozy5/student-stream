<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>SS Clips Admin | StudentStream</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
:root{
  --bg:#050816;
  --panel:#0c1426;
  --accent:#4facfe;
  --danger:#ff5c5c;
  --success:#4cff9a;
  --text:#eef3ff;
  --muted:#9aa8c7;
  --border:rgba(255,255,255,.08);
}

*{box-sizing:border-box;margin:0;padding:0}

body{
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
  background:radial-gradient(circle at top,#0f1f3a,#050816 70%);
  color:var(--text);
}

header{
  padding:22px 28px;
  border-bottom:1px solid var(--border);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

header h1{font-size:22px}

main{
  padding:32px;
  max-width:1400px;
  margin:auto;
}

.tabs{
  display:flex;
  gap:14px;
  margin-bottom:24px;
}

.tabs button{
  padding:10px 18px;
  border-radius:14px;
  background:var(--panel);
  border:1px solid var(--border);
  color:var(--text);
  cursor:pointer;
}

.tabs button.active{
  background:linear-gradient(135deg,#4facfe,#00f2fe);
  color:#00121f;
  font-weight:800;
}

table{
  width:100%;
  border-collapse:collapse;
  background:var(--panel);
  border-radius:18px;
  overflow:hidden;
}

th,td{
  padding:14px;
  border-bottom:1px solid var(--border);
  font-size:14px;
  vertical-align:top;
}

th{
  color:var(--muted);
  text-align:left;
  font-weight:600;
}

.actions button{
  padding:6px 12px;
  border-radius:10px;
  border:none;
  font-weight:700;
  cursor:pointer;
  margin-right:6px;
}

.approve{background:var(--success);color:#002b18}
.reject{background:var(--danger);color:#300}
.feature{background:var(--accent);color:#00121f}

.badge{
  padding:4px 8px;
  border-radius:8px;
  font-size:12px;
  font-weight:700;
}

.pending{background:#f5c76a;color:#2a1c00}
.approved{background:#4cff9a;color:#002b18}
.rejected{background:#ff7b7b;color:#300}

a{color:var(--accent);text-decoration:none}
</style>
</head>

<body>

<header>
  <h1>SS Clips — Admin Dashboard</h1>
  <span style="color:var(--muted)">StudentStream Internal</span>
</header>

<main>

<div class="tabs">
  <button class="active" onclick="loadClips('pending')">Pending</button>
  <button onclick="loadClips('approved')">Approved</button>
  <button onclick="loadClips('rejected')">Rejected</button>
</div>

<table>
<thead>
<tr>
  <th>Creator</th>
  <th>Clip</th>
  <th>Details</th>
  <th>Stats</th>
  <th>Actions</th>
</tr>
</thead>
<tbody id="rows"></tbody>
</table>

</main>

<script>
const supabase = supabase.createClient(
  "https://iabzmoxzbqzcqgypxctr.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlhYnptb3h6YnF6Y3FneXB4Y3RyIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2NzEwODM3MCwiZXhwIjoyMDgyNjg0MzcwfQ.CsPZH8iEu--QB8Zcug4TaqBS8T-g_eqWBbnx9zJH7yA"
);

let currentStatus = "pending";

async function loadClips(status){
  currentStatus = status;
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
  event.target.classList.add("active");

  const { data, error } = await supabase
    .from("clips")
    .select("*")
    .eq("status", status)
    .order("created_at", { ascending:false });

  if(error){ alert(error.message); return; }

  const tbody = document.getElementById("rows");
  tbody.innerHTML = "";

  data.forEach(c=>{
    tbody.innerHTML += `
      <tr>
        <td>
          <strong>${c.creator}</strong><br>
          <span style="color:var(--muted)">${c.email}</span>
        </td>

        <td>
          <a href="${c.clip_url}" target="_blank">View Clip</a><br>
          <span style="color:var(--muted)">${c.platform}</span>
        </td>

        <td>
          <span class="badge ${c.status}">${c.status}</span><br><br>
          Category: ${c.category}<br>
          Tier: ${c.tier ?? "—"}<br>
          Price: $${c.price ?? 0}<br>
          Featured: ${c.featured ? "Yes" : "No"}<br>
          Note: ${c.note ?? "—"}
        </td>

        <td>
          Views: ${c.views ?? 0}<br>
          Clicks: ${c.clicks ?? 0}<br>
          Paid: ${c.payment_status ?? "—"}
        </td>

        <td class="actions">
          ${status==="pending" ? `
            <button class="approve" onclick="approve('${c.id}')">Approve</button>
            <button class="reject" onclick="rejectClip('${c.id}')">Reject</button>
          ` : ""}
          <button class="feature" onclick="toggleFeature('${c.id}',${c.featured})">
            ${c.featured ? "Unfeature" : "Feature"}
          </button>
        </td>
      </tr>
    `;
  });
}

async function approve(id){
  await supabase.from("clips").update({
    status:"approved",
    approved_at:new Date()
  }).eq("id",id);
  loadClips(currentStatus);
}

async function rejectClip(id){
  await supabase.from("clips").update({
    status:"rejected",
    rejected_at:new Date()
  }).eq("id",id);
  loadClips(currentStatus);
}

async function toggleFeature(id,current){
  await supabase.from("clips").update({
    featured:!current
  }).eq("id",id);
  loadClips(currentStatus);
}

loadClips("pending");
</script>

</body>
</html>